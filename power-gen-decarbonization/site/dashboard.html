<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Dashboard — Power Generator Decarbonization</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>

<nav class="nav">
    <div class="nav-inner">
        <a href="index.html" class="nav-brand">Power Generator Decarbonization</a>
        <button class="nav-hamburger" onclick="document.querySelector('.nav-links').classList.toggle('open')">&#9776;</button>
        <ul class="nav-links">
            <li><a href="index.html">Executive Summary</a></li>
            <li><a href="dashboard.html" class="active">Company Dashboard</a></li>
            <li><a href="fleet-analysis.html">Fleet Analysis</a></li>
            <li><a href="targets.html">Targets & Feasibility</a></li>
            <li><a href="policy.html">Policy & Conditions</a></li>
            <li><a href="methodology.html">Methodology</a></li>
        </ul>
    </div>
</nav>

<header class="hero" style="padding: 48px 24px 40px;">
    <div class="hero-inner">
        <p class="tagline">Interactive Analysis</p>
        <h1>Company Dashboard</h1>
        <p class="subtitle">Select a company to explore its generation fleet, emissions profile, decarbonization targets, and pathway feasibility.</p>
    </div>
</header>

<div class="main-content">

    <!-- Company Selector -->
    <div class="section" style="margin-bottom: 32px;">
        <div class="pill-group" id="companySelector" style="justify-content: center;"></div>
    </div>

    <!-- Company Profile Header -->
    <div id="profileHeader" class="card" style="margin-bottom: 32px; display: none;">
        <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 16px;">
            <div>
                <h2 id="companyName" style="margin-bottom: 4px;"></h2>
                <p id="companyNote" style="margin-bottom: 0; font-size: 0.92rem;"></p>
                <span id="companyType" class="type-badge" style="margin-top: 8px;"></span>
            </div>
            <div id="companyKeyNote" style="max-width: 400px; font-size: 0.88rem; color: var(--text-tertiary);"></div>
        </div>
    </div>

    <!-- Key Metrics -->
    <div class="stat-row" id="statRow" style="display: none;">
        <div class="stat-tile">
            <div class="stat-value highlight" id="metricGen">—</div>
            <div class="stat-label">TWh Generated</div>
        </div>
        <div class="stat-tile">
            <div class="stat-value danger" id="metricCO2">—</div>
            <div class="stat-label">MT CO₂/year</div>
        </div>
        <div class="stat-tile">
            <div class="stat-value" id="metricIntensity">—</div>
            <div class="stat-label">lbs CO₂/MWh</div>
        </div>
        <div class="stat-tile">
            <div class="stat-value" id="metricCapacity">—</div>
            <div class="stat-label">GW Capacity</div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="card-grid" id="chartsRow" style="display: none;">
        <div class="chart-container">
            <h3>Generation Mix by Fuel</h3>
            <div class="chart-wrapper" style="height: 300px;">
                <canvas id="fuelMixChart"></canvas>
            </div>
        </div>
        <div class="chart-container">
            <h3>Emissions Intensity vs. Peers</h3>
            <div class="chart-wrapper" style="height: 300px;">
                <canvas id="peerChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Company Details -->
    <div id="detailsSection" style="display: none; margin-top: 32px;">
        <div class="card-grid">
            <div class="card">
                <h3>Markets & Geography</h3>
                <p id="detailMarkets" style="font-size: 0.92rem;"></p>
                <p id="detailStates" style="font-size: 0.85rem; color: var(--text-tertiary);"></p>
            </div>
            <div class="card">
                <h3>Decarbonization Assessment</h3>
                <div id="detailAssessment"></div>
            </div>
        </div>

        <div class="chart-container" style="margin-top: 24px;">
            <h3 id="scenarioTitle">Scenario Analysis</h3>
            <div class="chart-wrapper" style="height: 350px;">
                <canvas id="scenarioChart"></canvas>
            </div>
            <p class="citation">Illustrative scenarios based on fleet characteristics, LCOE data, and CFE optimizer cost curves.</p>
        </div>
    </div>

    <!-- Comparison Mode -->
    <div class="section" style="margin-top: 48px;">
        <div class="section-header">
            <h2>Cross-Company Comparison</h2>
            <p>All 15 generators compared across key metrics.</p>
        </div>

        <div class="card-grid">
            <div class="chart-container">
                <h3>Total CO₂ Emissions by Company</h3>
                <div class="chart-wrapper" style="height: 400px;">
                    <canvas id="allCO2Chart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <h3>Fleet Fuel Mix Comparison</h3>
                <div class="chart-wrapper" style="height: 400px;">
                    <canvas id="allMixChart"></canvas>
                </div>
            </div>
        </div>
    </div>

</div>

<footer class="page-footer">
    <div class="footer-links">
        <a href="index.html">Executive Summary</a>
        <a href="dashboard.html">Company Dashboard</a>
        <a href="fleet-analysis.html">Fleet Analysis</a>
        <a href="targets.html">Targets & Feasibility</a>
        <a href="policy.html">Policy & Conditions</a>
        <a href="methodology.html">Methodology</a>
    </div>
    <div class="footer-note">Analysis based on EPA eGRID 2023, EIA data, company filings, and hourly CFE optimizer modeling. &copy; 2026</div>
</footer>
<div class="bottom-bar"></div>

<script>
// ============================================================
// DATA
// ============================================================
const companies = [
    { name: "Constellation Energy", note: "Combined with Calpine (acquired Jan 2026)", type: "Merchant/IPP", gen: 310, co2: 55, intensity: 390, capacity: 60, mix: { Nuclear: 45, Gas: 42, Geothermal: 3, Hydro: 3, Wind: 4, Solar: 2, Oil: 1 }, markets: "PJM, ERCOT, CAISO, NYISO, ISO-NE", states: ["IL","PA","NY","TX","CA","MD","NJ"], keyNote: "Largest US power generator post-merger. Nuclear fleet is largest in US (~23 GW). Calpine adds ~27 GW gas + 725 MW geothermal.", archetype: "nuclear-led", assessment: "green" },
    { name: "NextEra Energy", note: "FPL (regulated FL utility) + NEER (competitive renewables/gas)", type: "Hybrid", gen: 170, co2: 38, intensity: 490, capacity: 72, mix: { Gas: 40, Nuclear: 14, Wind: 25, Solar: 15, Oil: 3, Other: 3 }, markets: "Florida (regulated), ERCOT, SPP, PJM, CAISO, MISO", states: ["FL","TX","IA","OK","CA","CO","IL"], keyNote: "World's largest generator of wind and solar energy. FPL is largest US utility by retail MWh. ~33 GW NEER competitive portfolio.", archetype: "renewable-leader", assessment: "green" },
    { name: "Duke Energy", note: "Vertically integrated utility serving 8.2M customers", type: "Vertically integrated", gen: 203, co2: 72, intensity: 780, capacity: 50, mix: { Gas: 48, Nuclear: 32, Coal: 13, Solar: 3, Hydro: 2, Wind: 1, Oil: 1 }, markets: "Duke Carolinas (SERC), Duke Florida, Duke Indiana (MISO)", states: ["NC","SC","FL","IN","OH","KY"], keyNote: "2nd largest US utility by retail customers. Significant remaining coal fleet in Indiana. Nuclear fleet ~11 GW.", archetype: "diversified", assessment: "yellow" },
    { name: "Southern Company", note: "Vertically integrated utility in Southeast US", type: "Vertically integrated", gen: 180, co2: 65, intensity: 795, capacity: 46, mix: { Gas: 50, Nuclear: 20, Coal: 18, Solar: 5, Hydro: 4, Wind: 1, Other: 2 }, markets: "Southern (SERC), SPP (Southern Power)", states: ["GA","AL","MS"], keyNote: "Vogtle Units 3&4 (newest US nuclear) operational 2023-2024. Still significant coal. Plant Barry CCS pilot.", archetype: "diversified", assessment: "yellow" },
    { name: "Vistra Energy", note: "Largest competitive power generator in Texas", type: "Merchant/IPP", gen: 140, co2: 68, intensity: 1070, capacity: 41, mix: { Gas: 50, Coal: 25, Nuclear: 15, Solar: 8, Battery: 2 }, markets: "ERCOT, PJM, ISO-NE", states: ["TX","IL","OH","PA"], keyNote: "Comanche Peak nuclear (2.4 GW). Significant coal in Illinois. Growing solar+battery portfolio in TX.", archetype: "coal-heavy", assessment: "red" },
    { name: "AEP", note: "American Electric Power — large regulated utility", type: "Vertically integrated", gen: 110, co2: 55, intensity: 1100, capacity: 30, mix: { Gas: 42, Coal: 30, Wind: 12, Nuclear: 5, Solar: 4, Hydro: 3, Other: 4 }, markets: "PJM, SPP, ERCOT", states: ["OH","TX","WV","VA","IN","OK"], keyNote: "One of the highest-emitting US utilities. Significant remaining coal. Large wind portfolio in Oklahoma/Texas.", archetype: "coal-heavy", assessment: "red" },
    { name: "Dominion Energy", note: "Vertically integrated utility, primarily Virginia", type: "Vertically integrated", gen: 90, co2: 30, intensity: 735, capacity: 30, mix: { Gas: 48, Nuclear: 33, Coal: 8, Solar: 5, Hydro: 3, Wind: 1, Biomass: 2 }, markets: "PJM (Dominion zone)", states: ["VA","NC","SC"], keyNote: "VA Clean Economy Act mandates 100% clean by 2045. Offshore wind (CVOW 2.6 GW) under construction.", archetype: "diversified", assessment: "yellow" },
    { name: "BH Energy", note: "Berkshire Hathaway Energy (PacifiCorp, MidAmerican, NV Energy)", type: "Vertically integrated", gen: 85, co2: 42, intensity: 1090, capacity: 40, mix: { Coal: 30, Wind: 25, Gas: 20, Hydro: 10, Solar: 10, Geothermal: 3, Other: 2 }, markets: "Western EIM, MISO", states: ["IA","UT","WY","OR","WA","NV","CA"], keyNote: "MidAmerican nearly 100% renewable in Iowa. PacifiCorp has massive coal exposure + wildfire liability.", archetype: "coal-heavy", assessment: "red" },
    { name: "Entergy", note: "Vertically integrated utility in Gulf South", type: "Vertically integrated", gen: 80, co2: 28, intensity: 770, capacity: 30, mix: { Gas: 55, Nuclear: 30, Solar: 3, Coal: 3, Hydro: 2, Other: 7 }, markets: "MISO South", states: ["LA","TX","MS","AR"], keyNote: "Large nuclear fleet. Gas-heavy. Industrial load growth from LNG exports.", archetype: "gas-nuclear", assessment: "yellow" },
    { name: "AES Corp", note: "Global power company with US utility and merchant renewables", type: "Hybrid", gen: 75, co2: 28, intensity: 820, capacity: 35, mix: { Gas: 40, Coal: 15, Solar: 20, Wind: 10, Battery: 8, Other: 7 }, markets: "MISO, PJM, CAISO", states: ["IN","OH","CA","HI","NY"], keyNote: "Global renewables developer. AES Indiana still has significant coal. Fluence (JV) major battery provider.", archetype: "diversified", assessment: "yellow" },
    { name: "Xcel Energy", note: "Regulated utility in Upper Midwest and Colorado", type: "Vertically integrated", gen: 70, co2: 28, intensity: 880, capacity: 21, mix: { Wind: 30, Gas: 28, Coal: 20, Nuclear: 12, Solar: 7, Other: 3 }, markets: "MISO, SPP", states: ["MN","CO","WI","TX","NM"], keyNote: "First major US utility to pledge 100% carbon-free by 2050. Leading wind buildout.", archetype: "diversified", assessment: "yellow" },
    { name: "Evergy", note: "Regulated utility in Kansas and Missouri", type: "Vertically integrated", gen: 50, co2: 26, intensity: 1145, capacity: 12, mix: { Coal: 40, Wind: 25, Gas: 18, Nuclear: 10, Solar: 3, Other: 4 }, markets: "SPP", states: ["KS","MO"], keyNote: "One of the highest-intensity utilities due to coal dependence. Strong wind resource in Kansas.", archetype: "coal-heavy", assessment: "red" },
    { name: "DTE Energy", note: "Regulated utility in Michigan", type: "Vertically integrated", gen: 45, co2: 20, intensity: 980, capacity: 12, mix: { Gas: 40, Coal: 28, Nuclear: 15, Wind: 8, Solar: 5, Biomass: 4 }, markets: "MISO", states: ["MI"], keyNote: "Fermi 2 nuclear. MI legislation requires 100% clean by 2040. Retiring Belle River coal.", archetype: "diversified", assessment: "yellow" },
    { name: "WEC Energy", note: "Regulated utility in Wisconsin/Michigan/Illinois", type: "Vertically integrated", gen: 40, co2: 17, intensity: 935, capacity: 9, mix: { Gas: 45, Coal: 22, Nuclear: 16, Wind: 8, Solar: 5, Other: 4 }, markets: "MISO", states: ["WI","MI","IL"], keyNote: "Point Beach nuclear. Coal retirement accelerating.", archetype: "diversified", assessment: "yellow" },
    { name: "PPL Corp", note: "Primarily T&D utility; KY generation remaining", type: "Hybrid", gen: 35, co2: 20, intensity: 1260, capacity: 8, mix: { Gas: 50, Coal: 30, Hydro: 8, Solar: 5, Other: 7 }, markets: "PJM, SERC", states: ["PA","KY","RI"], keyNote: "Remaining KY generation is coal/gas heavy. PA and RI are T&D only.", archetype: "coal-heavy", assessment: "red" }
];

const fuelColors = {
    Nuclear: '#7C3AED', Gas: '#EF4444', Coal: '#374151', Wind: '#0EA5E9',
    Solar: '#F59E0B', Hydro: '#06B6D4', Geothermal: '#10B981', Battery: '#8B5CF6',
    Oil: '#9CA3AF', Biomass: '#84CC16', Other: '#D1D5DB'
};

const assessmentLabels = { green: 'On Track / Low Intensity', yellow: 'Achievable with Policy Support', red: 'Challenging Without Major Policy' };
const assessmentColors = { green: '#22C55E', yellow: '#F59E0B', red: '#DC2626' };

let selectedCompany = null;
let fuelMixChartInstance = null;
let peerChartInstance = null;
let scenarioChartInstance = null;

// ============================================================
// COMPANY SELECTOR PILLS
// ============================================================
const selector = document.getElementById('companySelector');
companies.forEach((c, i) => {
    const pill = document.createElement('button');
    pill.className = 'pill';
    pill.textContent = c.name;
    pill.onclick = () => selectCompany(i);
    selector.appendChild(pill);
});

function selectCompany(idx) {
    const c = companies[idx];
    selectedCompany = idx;

    // Update pill active states
    document.querySelectorAll('#companySelector .pill').forEach((p, i) => {
        p.classList.toggle('active', i === idx);
    });

    // Show sections
    document.getElementById('profileHeader').style.display = 'block';
    document.getElementById('statRow').style.display = 'grid';
    document.getElementById('chartsRow').style.display = 'grid';
    document.getElementById('detailsSection').style.display = 'block';

    // Update profile header
    document.getElementById('companyName').textContent = c.name;
    document.getElementById('companyNote').textContent = c.note;
    const typeBadge = document.getElementById('companyType');
    typeBadge.textContent = c.type;
    typeBadge.className = 'type-badge ' + (c.type.includes('Merchant') ? 'merchant' : c.type.includes('Hybrid') ? 'hybrid' : 'utility');
    document.getElementById('companyKeyNote').textContent = c.keyNote;

    // Update stats
    document.getElementById('metricGen').textContent = c.gen + ' TWh';
    document.getElementById('metricCO2').textContent = c.co2 + ' MT';
    document.getElementById('metricIntensity').textContent = c.intensity.toLocaleString();
    document.getElementById('metricCapacity').textContent = c.capacity + ' GW';

    // Update markets
    document.getElementById('detailMarkets').textContent = c.markets;
    document.getElementById('detailStates').textContent = 'States: ' + c.states.join(', ');

    // Assessment
    const assessDiv = document.getElementById('detailAssessment');
    assessDiv.innerHTML = `
        <div class="traffic-light" style="margin-bottom: 8px;">
            <span class="traffic-dot ${c.assessment}"></span>
            <span>${assessmentLabels[c.assessment]}</span>
        </div>
        <p style="font-size: 0.88rem; color: var(--text-secondary);">
            ${getAssessmentText(c)}
        </p>
    `;

    // Update charts
    updateFuelMixChart(c);
    updatePeerChart(c, idx);
    updateScenarioChart(c);

    // Scroll to profile
    document.getElementById('profileHeader').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function getAssessmentText(c) {
    if (c.assessment === 'green') return `With an intensity of ${c.intensity} lbs CO₂/MWh, ${c.name} is already below the US average (~760 lbs/MWh). Primary challenge is maintaining low-carbon status during load growth, not fundamental fleet transformation.`;
    if (c.assessment === 'yellow') return `${c.name} has a diversified fleet with a path to significant reductions through coal retirement and renewable expansion. IRA tax credits and supportive state policy could accelerate the timeline. Remaining gas generation presents a longer-term challenge.`;
    return `${c.name} faces significant decarbonization challenges due to coal dependence (${c.mix.Coal || 0}% of generation). However, coal-to-renewable substitution offers large, low-cost abatement potential. The key barriers are stranded asset exposure, regulatory approval for early retirement, and replacement resource buildout pace.`;
}

function updateFuelMixChart(c) {
    if (fuelMixChartInstance) fuelMixChartInstance.destroy();
    const fuels = Object.entries(c.mix).filter(([_, v]) => v > 0).sort((a, b) => b[1] - a[1]);
    fuelMixChartInstance = new Chart(document.getElementById('fuelMixChart').getContext('2d'), {
        type: 'doughnut',
        data: {
            labels: fuels.map(f => f[0]),
            datasets: [{ data: fuels.map(f => f[1]), backgroundColor: fuels.map(f => fuelColors[f[0]] || '#D1D5DB'), borderWidth: 2, borderColor: '#fff' }]
        },
        options: {
            responsive: true, maintainAspectRatio: false,
            plugins: {
                legend: { position: 'right', labels: { usePointStyle: true, padding: 10, font: { size: 11 } } },
                tooltip: { callbacks: { label: ctx => `${ctx.label}: ${ctx.raw}%` } }
            },
            cutout: '55%'
        }
    });
}

function updatePeerChart(c, idx) {
    if (peerChartInstance) peerChartInstance.destroy();
    const sorted = [...companies].sort((a, b) => a.intensity - b.intensity);
    const colors = sorted.map(p => p.name === c.name ? '#0EA5E9' : '#E5E7EB');
    peerChartInstance = new Chart(document.getElementById('peerChart').getContext('2d'), {
        type: 'bar',
        data: {
            labels: sorted.map(p => p.name.replace(' Energy', '').replace(' Corp', '')),
            datasets: [{ data: sorted.map(p => p.intensity), backgroundColor: colors, borderRadius: 4 }]
        },
        options: {
            responsive: true, maintainAspectRatio: false, indexAxis: 'y',
            plugins: { legend: { display: false } },
            scales: {
                x: { title: { display: true, text: 'lbs CO₂/MWh' }, grid: { display: false }, border: { display: true } },
                y: { grid: { display: false }, border: { display: true }, ticks: { font: { size: 10 } } }
            }
        }
    });
}

function updateScenarioChart(c) {
    if (scenarioChartInstance) scenarioChartInstance.destroy();
    document.getElementById('scenarioTitle').textContent = `${c.name}: Emission Reduction Scenarios`;

    // Generate scenario-specific data based on fleet archetype
    let bau, policyEnabled, sbti, nze;
    if (c.assessment === 'green') {
        bau = c.intensity * 0.9; policyEnabled = c.intensity * 0.7; sbti = c.intensity * 0.4; nze = 50;
    } else if (c.assessment === 'yellow') {
        bau = c.intensity * 0.85; policyEnabled = c.intensity * 0.55; sbti = c.intensity * 0.3; nze = 50;
    } else {
        bau = c.intensity * 0.75; policyEnabled = c.intensity * 0.4; sbti = c.intensity * 0.25; nze = 50;
    }

    scenarioChartInstance = new Chart(document.getElementById('scenarioChart').getContext('2d'), {
        type: 'bar',
        data: {
            labels: ['Current (2023)', 'BAU (2035)', 'Policy-Enabled (2035)', 'SBTi-Aligned (2035)', 'IEA NZE (2035)'],
            datasets: [{
                label: 'CO₂ Intensity (lbs/MWh)',
                data: [c.intensity, Math.round(bau), Math.round(policyEnabled), Math.round(sbti), nze],
                backgroundColor: ['#9CA3AF', '#6B7280', '#F59E0B', '#0EA5E9', '#22C55E'],
                borderRadius: 6
            }]
        },
        options: {
            responsive: true, maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: { title: { display: true, text: 'lbs CO₂/MWh', font: { weight: 600 } }, beginAtZero: true, grid: { color: 'rgba(0,0,0,0.05)' }, border: { display: true } },
                x: { grid: { display: false }, border: { display: true }, ticks: { font: { size: 11 } } }
            }
        }
    });
}

// ============================================================
// ALL-COMPANY COMPARISON CHARTS
// ============================================================
// CO2 Emissions Chart
const sorted = [...companies].sort((a, b) => b.co2 - a.co2);
new Chart(document.getElementById('allCO2Chart').getContext('2d'), {
    type: 'bar',
    data: {
        labels: sorted.map(c => c.name),
        datasets: [{
            label: 'MT CO₂/year',
            data: sorted.map(c => c.co2),
            backgroundColor: sorted.map(c => {
                if (c.intensity < 600) return '#22C55E';
                if (c.intensity < 900) return '#F59E0B';
                return '#DC2626';
            }),
            borderRadius: 6
        }]
    },
    options: {
        responsive: true, maintainAspectRatio: false, indexAxis: 'y',
        plugins: { legend: { display: false } },
        scales: {
            x: { title: { display: true, text: 'Million Tons CO₂ / year' }, grid: { display: false }, border: { display: true } },
            y: { grid: { display: false }, border: { display: true }, ticks: { font: { size: 10 } } }
        }
    }
});

// Fuel Mix Comparison
const allFuels = ['Nuclear', 'Gas', 'Coal', 'Wind', 'Solar', 'Hydro', 'Geothermal', 'Battery', 'Biomass', 'Oil', 'Other'];
const mixDatasets = allFuels.map(fuel => ({
    label: fuel,
    data: companies.map(c => c.mix[fuel] || 0),
    backgroundColor: fuelColors[fuel] || '#D1D5DB'
})).filter(ds => ds.data.some(v => v > 0));

new Chart(document.getElementById('allMixChart').getContext('2d'), {
    type: 'bar',
    data: { labels: companies.map(c => c.name.replace(' Energy', '').replace(' Corp', '')), datasets: mixDatasets },
    options: {
        responsive: true, maintainAspectRatio: false,
        plugins: { legend: { position: 'bottom', labels: { usePointStyle: true, padding: 8, font: { size: 10 } } } },
        scales: {
            x: { stacked: true, grid: { display: false }, border: { display: true }, ticks: { font: { size: 9 }, maxRotation: 45 } },
            y: { stacked: true, max: 100, title: { display: true, text: '% of Generation' }, grid: { color: 'rgba(0,0,0,0.05)' }, border: { display: true } }
        }
    }
});

// Select first company by default
selectCompany(0);
</script>

</body>
</html>
