<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NEISO Deep Dive — Hourly CFE Optimizer</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Rajdhani:wght@400;500;600;700&family=Barlow+Semi+Condensed:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
@font-face {
    font-family: 'Franklin Gothic Demi';
    src: local('Franklin Gothic Demi'), local('Franklin Gothic Medium'), local('ITC Franklin Gothic Demi'), local('Franklin Gothic Demi Cond');
    font-weight: 600;
    font-style: normal;
    font-display: swap;
}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
<style>
/* ========== RESET & BASE ========== */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html {
    font-size: 17px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    scroll-behavior: smooth;
}

body {
    font-family: 'Plus Jakarta Sans', 'Helvetica Neue', Arial, sans-serif;
    background: #0F1A2E;
    background-image:
        radial-gradient(ellipse at 20% 0%, rgba(14,165,233,0.06) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 100%, rgba(245,158,11,0.04) 0%, transparent 50%);
    background-attachment: fixed;
    color: #000000;
    line-height: 1.55;
    min-height: 100vh;
}

:root {
    --navy: #1A2744;
    --navy-light: #2D3A52;
    --bg-card: #FFFFFF;
    --bg-card-hover: #F7F8FA;
    --border: #D4D8E0;
    --border-light: #E5E7EB;
    --text-primary: #000000;
    --text-secondary: #000000;
    --text-muted: #6B7280;
    --clean-firm: #1E3A5F;
    --solar: #F59E0B;
    --wind: #22C55E;
    --hydro: #0EA5E9;
    --storage: #EF4444;
    --accent-blue: #4a90d9;
    --accent-warm: #f4a261;
}

/* ========== TOP NAVIGATION BAR ========== */
.top-nav {
    background: #1a1a2e;
    padding: 0 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: sticky;
    top: 0;
    z-index: 999;
    border-bottom: 1px solid rgba(255,255,255,0.08);
    min-height: 48px;
}
.top-nav-inner {
    display: flex;
    align-items: center;
    gap: 0;
    max-width: 1440px;
    width: 100%;
    justify-content: center;
}
.top-nav a {
    color: rgba(255,255,255,0.75);
    text-decoration: none;
    font-family: 'Franklin Gothic Demi', 'Barlow Semi Condensed', 'Arial Narrow', sans-serif;
    font-size: 0.85rem;
    font-weight: 600;
    letter-spacing: 0.04em;
    padding: 14px 18px;
    transition: color 0.2s, background 0.2s, border-color 0.2s;
    border-bottom: 3px solid transparent;
    white-space: nowrap;
}
.top-nav a:hover {
    color: #ffffff;
    background: rgba(255,255,255,0.06);
}
.top-nav a.nav-active {
    color: #ffffff;
    border-bottom-color: #0EA5E9;
    background: rgba(14,165,233,0.1);
}
.nav-hamburger {
    display: none;
    background: none;
    border: none;
    color: #ffffff;
    font-size: 1.5rem;
    cursor: pointer;
    padding: 10px;
    min-width: 44px;
    min-height: 44px;
    align-items: center;
    justify-content: center;
}
.nav-hamburger svg {
    width: 24px;
    height: 24px;
    stroke: currentColor;
    stroke-width: 2;
    fill: none;
}
@media (max-width: 768px) {
    .top-nav {
        flex-wrap: wrap;
        padding: 0 12px;
        justify-content: space-between;
    }
    .top-nav-inner {
        display: none;
        flex-direction: column;
        width: 100%;
        padding-bottom: 8px;
    }
    .top-nav-inner.nav-open {
        display: flex;
    }
    .top-nav a {
        padding: 12px 16px;
        border-bottom: none;
        border-left: 3px solid transparent;
        width: 100%;
        text-align: left;
    }
    .top-nav a.nav-active {
        border-left-color: #0EA5E9;
        border-bottom: none;
        background: rgba(14,165,233,0.12);
    }
    .nav-hamburger {
        display: flex;
    }
    .nav-brand {
        display: flex;
        align-items: center;
        color: #ffffff;
        font-family: 'Franklin Gothic Demi', 'Barlow Semi Condensed', sans-serif;
        font-size: 0.9rem;
        font-weight: 700;
        letter-spacing: 0.03em;
        padding: 12px 0;
    }
}
@media (min-width: 769px) {
    .nav-brand { display: none; }
}

/* ========== HEADER BANNER ========== */
.header {
    background: linear-gradient(135deg, #0F1A2E 0%, #122952 30%, #1565C0 70%, #0D47A1 100%);
    color: #ffffff;
    padding: 72px 24px 64px;
    text-align: center;
    position: relative;
    overflow: hidden;
}
/* Radial energy glows + dispatch stack curves (bottom) */
.header::before {
    content: '';
    position: absolute;
    inset: 0;
    z-index: 1;
    pointer-events: none;
    background:
        radial-gradient(ellipse 55% 70% at 12% 75%, rgba(14,165,233,0.4) 0%, transparent 65%),
        radial-gradient(ellipse 45% 60% at 38% 85%, rgba(34,197,94,0.35) 0%, transparent 60%),
        radial-gradient(ellipse 50% 65% at 62% 80%, rgba(245,158,11,0.35) 0%, transparent 60%),
        radial-gradient(ellipse 40% 55% at 88% 70%, rgba(239,68,68,0.3) 0%, transparent 55%),
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 240' preserveAspectRatio='none'%3E%3Cdefs%3E%3ClinearGradient id='a1' x1='0' y1='0' x2='0' y2='1'%3E%3Cstop offset='0' stop-color='rgba(255,255,255,0.15)'/%3E%3Cstop offset='1' stop-color='rgba(255,255,255,0.01)'/%3E%3C/linearGradient%3E%3ClinearGradient id='a2' x1='0' y1='0' x2='0' y2='1'%3E%3Cstop offset='0' stop-color='rgba(34,197,94,0.35)'/%3E%3Cstop offset='1' stop-color='rgba(34,197,94,0.03)'/%3E%3C/linearGradient%3E%3ClinearGradient id='a3' x1='0' y1='0' x2='0' y2='1'%3E%3Cstop offset='0' stop-color='rgba(245,158,11,0.35)'/%3E%3Cstop offset='1' stop-color='rgba(245,158,11,0.03)'/%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath d='M0,240 L0,130 C200,100 400,70 600,80 C800,90 1000,120 1200,100 L1200,240 Z' fill='url(%23a1)'/%3E%3Cpath d='M0,240 L0,160 C200,140 400,115 600,125 C800,135 1000,155 1200,140 L1200,240 Z' fill='url(%23a2)'/%3E%3Cpath d='M0,240 L0,190 C200,180 400,165 600,170 C800,175 1000,188 1200,180 L1200,240 Z' fill='url(%23a3)'/%3E%3Cpath d='M0,130 C200,100 400,70 600,80 C800,90 1000,120 1200,100' fill='none' stroke='rgba(255,255,255,0.45)' stroke-width='2'/%3E%3Cpath d='M0,160 C200,140 400,115 600,125 C800,135 1000,155 1200,140' fill='none' stroke='%2322C55E' stroke-width='2' stroke-opacity='0.6'/%3E%3Cpath d='M0,190 C200,180 400,165 600,170 C800,175 1000,188 1200,180' fill='none' stroke='%23F59E0B' stroke-width='2' stroke-opacity='0.6'/%3E%3C/svg%3E") no-repeat bottom center;
    background-size: 100% 100%, 100% 100%, 100% 100%, 100% 100%, 100% 100%;
}
/* Vibrant pulse lines (top) + dark text backing overlay */
.header::after {
    content: '';
    position: absolute;
    inset: 0;
    z-index: 1;
    pointer-events: none;
    background:
        radial-gradient(ellipse 70% 45% at 50% 45%, rgba(5,15,35,0.55) 0%, transparent 100%),
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 80' preserveAspectRatio='none'%3E%3Cpath d='M0,50 L250,50 L270,18 L288,68 L306,22 L324,60 L342,50 L1200,50' fill='none' stroke='rgba(14,165,233,0.5)' stroke-width='2'/%3E%3Cpath d='M0,35 L600,35 L618,10 L636,60 L654,14 L672,55 L690,35 L1200,35' fill='none' stroke='rgba(245,158,11,0.4)' stroke-width='2'/%3E%3C/svg%3E") no-repeat top center;
    background-size: 100% 100%, 100% 80px;
}
.header-accent {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #1A2744 0%, #0EA5E9 25%, #22C55E 50%, #F59E0B 75%, #EF4444 100%);
    z-index: 2;
}
.header h1 {
    font-family: 'Franklin Gothic Demi', 'Lexend', 'Rajdhani', 'Arial Narrow', 'Helvetica Neue', Arial, sans-serif;
    font-weight: 700;
    font-size: 3.2rem;
    letter-spacing: 0.5px;
    text-transform: none;
    margin-bottom: 14px;
    position: relative;
    z-index: 3;
    text-shadow: 0 2px 20px rgba(0,0,0,0.5), 0 1px 3px rgba(0,0,0,0.3);
    line-height: 1.15;
}
.header .subtitle {
    font-family: 'Plus Jakarta Sans', 'Helvetica Neue', Arial, sans-serif;
    font-size: 1.15rem;
    font-weight: 400;
    opacity: 0.92;
    max-width: 660px;
    margin: 0 auto;
    letter-spacing: 0.2px;
    position: relative;
    z-index: 3;
    text-shadow: 0 2px 12px rgba(0,0,0,0.4), 0 1px 2px rgba(0,0,0,0.2);
    line-height: 1.55;
}

/* ========== MAIN CONTENT ========== */
.main-content {
    max-width: 1440px;
    margin: 0 auto;
    padding: 0;
    background: #F3F4F8;
}

/* ========== SCROLLYTELLING SECTIONS ========== */
.scroll-section {
    min-height: 80vh;
    padding: 80px 44px;
    border-bottom: 1px solid var(--border-light);
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
}
.scroll-section:last-child {
    border-bottom: none;
}
.scroll-section:nth-child(even) {
    background: #FFFFFF;
}
.scroll-section:nth-child(odd) {
    background: #F3F4F8;
}
.section-number {
    font-family: 'Franklin Gothic Demi', 'Barlow Semi Condensed', sans-serif;
    font-size: 0.78rem;
    font-weight: 700;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--accent-blue);
    margin-bottom: 12px;
}
.section-title {
    font-family: 'Franklin Gothic Demi', 'Lexend', 'Rajdhani', 'Arial Narrow', sans-serif;
    font-weight: 700;
    font-size: 2.2rem;
    color: var(--navy);
    margin-bottom: 32px;
    text-align: center;
    line-height: 1.2;
    max-width: 800px;
}
.section-narrative {
    max-width: 800px;
    font-size: 1.06rem;
    line-height: 1.75;
    color: var(--text-primary);
    margin-bottom: 24px;
}
.section-narrative p {
    margin-bottom: 20px;
}
.section-narrative strong {
    color: var(--navy);
}

/* ========== CHART PLACEHOLDERS ========== */
.chart-container {
    width: 100%;
    max-width: 700px;
    margin: 32px auto;
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: 12px;
    padding: 28px;
    position: relative;
}
.chart-container canvas {
    width: 100% !important;
    height: 350px !important;
}
.chart-container .chart-title {
    font-family: 'Franklin Gothic Demi', 'Barlow Semi Condensed', sans-serif;
    font-weight: 600;
    font-size: 1.0rem;
    color: var(--navy);
    margin-bottom: 16px;
    text-align: center;
}
.chart-placeholder-msg {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: var(--text-muted);
    font-size: 0.9rem;
    font-style: italic;
    text-align: center;
    padding: 20px;
    pointer-events: none;
}

/* ========== KEY INSIGHTS ========== */
.insights-list {
    max-width: 800px;
    list-style: none;
    padding: 0;
}
.insights-list li {
    position: relative;
    padding: 16px 0 16px 36px;
    font-size: 1.06rem;
    line-height: 1.65;
    border-bottom: 1px solid var(--border-light);
}
.insights-list li:last-child {
    border-bottom: none;
}
.insights-list li::before {
    content: '';
    position: absolute;
    left: 0;
    top: 22px;
    width: 18px;
    height: 18px;
    background: var(--accent-blue);
    border-radius: 50%;
    opacity: 0.8;
}

/* ========== STAT CALLOUT ========== */
.stat-callout {
    display: flex;
    gap: 32px;
    flex-wrap: wrap;
    justify-content: center;
    margin: 32px 0;
    max-width: 800px;
}
.stat-box {
    background: linear-gradient(145deg, #f8f9fb 0%, #f0f2f5 100%);
    border: 1px solid var(--border-light);
    border-radius: 10px;
    padding: 24px 32px;
    text-align: center;
    min-width: 160px;
    flex: 1;
    max-width: 220px;
}
.stat-value {
    font-family: 'Franklin Gothic Demi', 'Barlow Semi Condensed', sans-serif;
    font-size: 2rem;
    font-weight: 700;
    color: var(--navy);
    line-height: 1.1;
}
.stat-label {
    font-size: 0.82rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--text-muted);
    margin-top: 6px;
}

/* ========== FOOTER ========== */
.page-footer {
    background: #1a1a2e;
    color: rgba(255,255,255,0.7);
    padding: 48px 24px;
    text-align: center;
}
.footer-links {
    display: flex;
    gap: 24px;
    justify-content: center;
    flex-wrap: wrap;
    margin-bottom: 20px;
}
.footer-links a {
    color: rgba(255,255,255,0.8);
    text-decoration: none;
    font-family: 'Franklin Gothic Demi', 'Barlow Semi Condensed', sans-serif;
    font-size: 0.88rem;
    font-weight: 600;
    letter-spacing: 0.04em;
    padding: 8px 16px;
    border-radius: 6px;
    transition: background 0.2s, color 0.2s;
    min-height: 44px;
    display: flex;
    align-items: center;
}
.footer-links a:hover {
    background: rgba(255,255,255,0.08);
    color: #ffffff;
}
.footer-note {
    font-size: 0.82rem;
    opacity: 0.5;
    margin-top: 12px;
}

/* ========== BOTTOM ACCENT BAR ========== */
.bottom-banner {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 6px;
    background: linear-gradient(90deg, #1A2744 0%, #0EA5E9 25%, #22C55E 50%, #F59E0B 75%, #EF4444 100%);
    z-index: 1000;
}

/* ========== RESPONSIVE ========== */
@media (max-width: 768px) {
    .header { padding: 60px 16px 50px; }
    .header h1 { font-size: 2.2rem; }
    .header .subtitle { font-size: 1rem; }
    .scroll-section { padding: 48px 20px; min-height: auto; }
    .section-title { font-size: 1.7rem; }
    .section-narrative { font-size: 1rem; }
    .chart-container { padding: 16px; }
    .chart-container canvas { height: 260px !important; }
    .stat-callout { gap: 16px; }
    .stat-box { min-width: 130px; padding: 16px 20px; }
    .stat-value { font-size: 1.6rem; }
}
@media (max-width: 480px) {
    .header h1 { font-size: 1.8rem; }
    .stat-callout { flex-direction: column; align-items: center; }
    .stat-box { max-width: 100%; width: 100%; }
}

/* Scroll-triggered animations */
@keyframes fadeSlideUp {
    from { opacity: 0; transform: translateY(40px); }
    to   { opacity: 1; transform: translateY(0); }
}
.scroll-reveal {
    opacity: 0;
    transform: translateY(40px);
    transition: opacity 0.7s cubic-bezier(0.23, 1, 0.32, 1), transform 0.7s cubic-bezier(0.23, 1, 0.32, 1);
}
.scroll-reveal.revealed {
    opacity: 1;
    transform: translateY(0);
}
.scroll-reveal.reveal-delay-1 { transition-delay: 0.15s; }
.scroll-reveal.reveal-delay-2 { transition-delay: 0.3s; }
.scroll-reveal.reveal-delay-3 { transition-delay: 0.45s; }
.scroll-section {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.scroll-section:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.08);
}
@media (prefers-reduced-motion: reduce) {
    .scroll-reveal { opacity: 1; transform: none; transition: none; }
    .scroll-section:hover { transform: none; box-shadow: none; }
}
</style>
</head>
<body>

<!-- ========== TOP NAVIGATION ========== -->
<nav class="top-nav">
    <span class="nav-brand">Hourly CFE Optimizer</span>
    <button class="nav-hamburger" onclick="document.querySelector('.top-nav-inner').classList.toggle('nav-open')" aria-label="Toggle navigation">
        <svg viewBox="0 0 24 24"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
    </button>
    <div class="top-nav-inner">
        <a href="dashboard.html">Dashboard</a>
        <a href="region_caiso.html">CAISO</a>
        <a href="region_ercot.html">ERCOT</a>
        <a href="region_pjm.html">PJM</a>
        <a href="region_nyiso.html">NYISO</a>
        <a href="region_neiso.html" class="nav-active">NEISO</a>
        <a href="abatement_comparison.html">Abatement</a>
        <a href="optimizer_methodology.html">Methodology</a>
        <a href="research_paper.html">Paper</a>
    </div>
</nav>

<!-- ========== HEADER BANNER ========== -->
<header class="header">
    <h1>NEISO Deep Dive</h1>
    <p class="subtitle">New England's Decarbonization Pathway</p>
    <div class="header-accent"></div>
</header>

<!-- ========== MAIN CONTENT ========== -->
<main class="main-content">

    <!-- Key Insights (moved to top) -->
    <section class="scroll-section">
        <h2 class="section-title">What Makes NEISO Unique</h2>
        <div class="section-narrative">
            <p>New England occupies a distinctive position in the American clean energy landscape -- a small, wealthy region with aggressive climate goals, strong nuclear and nascent wind portfolios, but structural cost disadvantages. Here are the key takeaways for procurement strategists:</p>
        </div>
        <ul class="insights-list">
            <li><strong>Nuclear provides a powerful starting advantage.</strong> With 23.8% clean firm generation, NEISO has the second-highest nuclear share after PJM. This existing around-the-clock clean power means the region needs less new build to reach moderate hourly matching thresholds. Protecting existing nuclear plants is among the most cost-effective actions available.</li>
            <li><strong>Wind is the growth engine, with offshore as the potential game-changer.</strong> Current onshore wind at 3.9% is small but growing, and the optimizer deploys wind aggressively at every threshold. Offshore wind in the Gulf of Maine and southern New England waters could fundamentally change the economics -- higher capacity factors, closer to demand centers, and less intermittent than onshore sites. This is the single biggest variable in NEISO's clean energy future.</li>
            <li><strong>Winter reliability is the binding constraint.</strong> New England's hardest hours to decarbonize are not summer afternoons (as in PJM) or nighttime hours (as in CAISO), but extended cold winter periods when gas supply is constrained, heating demand peaks, and both wind and solar output can drop simultaneously. This winter challenge drives LDES deployment and the steep cost escalation above 95%.</li>
            <li><strong>Pipeline gas dependence creates unique risk.</strong> New England's reliance on natural gas -- for both electricity generation and home heating -- through a capacity-constrained pipeline network creates price volatility that affects both wholesale electricity costs and the economic case for clean energy alternatives. Clean energy procurement is effectively a hedge against gas price spikes.</li>
            <li><strong>RGGI participation creates a policy tailwind.</strong> As a RGGI member, New England states already price carbon in the electricity sector. This creates a floor value for clean energy abatement credits and strengthens the economic case for procurement, especially as RGGI's cap continues to tighten.</li>
        </ul>
    </section>

    <!-- SECTION 1: Region Overview -->
    <section class="scroll-section">
        <span class="section-number">Section 1</span>
        <h2 class="section-title">The New England Grid at a Glance</h2>
        <div class="section-narrative">
            <p>ISO New England (NEISO) operates the electricity grid for six states: Connecticut, Maine, Massachusetts, New Hampshire, Rhode Island, and Vermont. This compact region -- roughly the size of Washington State -- punches above its weight economically, home to world-class universities, a thriving biotech industry, and some of the oldest and most densely settled communities in America. New England's electricity grid reflects this character: sophisticated, constrained, and expensive to operate.</p>
            <p>NEISO has the strongest nuclear foundation of any region outside PJM, with <strong>23.8% of generation from clean firm sources</strong> -- primarily the Millstone nuclear plant in Connecticut and the Seabrook station in New Hampshire. These plants provide reliable around-the-clock clean energy that forms the bedrock of New England's decarbonization starting point. Add in a modest hydro contribution (4.4%), small but growing wind (3.9%) and solar (1.4%) portfolios, and NEISO starts at roughly <strong>33.5% clean energy</strong>.</p>
            <p>The challenge for New England is that nearly everything costs more here than in most other U.S. regions. Wholesale electricity prices average about $41/MWh -- among the highest in the country -- driven by New England's heavy dependence on natural gas (which must be imported via a constrained pipeline network), limited transmission capacity, and an aging grid that requires constant investment. Winter is the critical season: when natural gas demand spikes for home heating, pipeline capacity maxes out, gas prices can surge to extraordinary levels, and electricity prices follow. This "winter reliability" problem has shaped New England grid planning for over a decade.</p>
        </div>
        <div class="stat-callout">
            <div class="stat-box">
                <div class="stat-value">23.8%</div>
                <div class="stat-label">Clean Firm</div>
            </div>
            <div class="stat-box">
                <div class="stat-value">3.9%</div>
                <div class="stat-label">Wind Share</div>
            </div>
            <div class="stat-box">
                <div class="stat-value">4.4%</div>
                <div class="stat-label">Hydro Share</div>
            </div>
            <div class="stat-box">
                <div class="stat-value">1.4%</div>
                <div class="stat-label">Solar Share</div>
            </div>
        </div>
    </section>

    <!-- SECTION 2: Today's Starting Point -->
    <section class="scroll-section">
        <span class="section-number">Section 2</span>
        <h2 class="section-title">Today's Starting Point: What the Existing Grid Delivers</h2>
        <div class="section-narrative">
            <p>New England's existing clean energy profile shares some similarities with neighboring NYISO -- a nuclear backbone supplemented by hydro -- but with key differences. NEISO's nuclear share (23.8%) is higher than NYISO's (18.4%), but its hydro share (4.4%) is much lower than New York's (15.9%). This means NEISO's hourly clean energy floor is higher (thanks to nuclear) but its peak clean hours are lower (less hydro to top off).</p>
            <p>Think of it as having a bigger, steadier paycheck (nuclear) but a smaller bonus potential (hydro). The result is a clean energy profile that is remarkably flat across hours of the day -- nuclear runs constantly -- but with modest peaks during spring high-water periods and troughs during hot summer afternoons when air conditioning drives demand above what clean sources can cover.</p>
            <p>The existing grid delivers roughly a third of all hours at clean energy levels, with nuclear doing the heavy lifting. The remaining two-thirds of demand is served primarily by natural gas, with retiring coal and oil plants filling the margins. This fossil generation is what needs to be displaced to reach higher hourly clean energy thresholds, and the composition of that fossil fleet (predominantly gas, with minimal coal) means each clean MWh displaces moderate amounts of CO2 -- more than in CAISO's very-clean gas fleet, but less than in PJM's coal-heavy generation mix.</p>
        </div>
        <div class="chart-container">
            <div class="chart-title">Hourly Clean Energy Match from Existing NEISO Grid</div>
            <canvas id="baselineChart"></canvas>
            <div class="chart-placeholder-msg">Chart data will populate when optimizer results are loaded</div>
        </div>
    </section>

    <!-- SECTION 3: The Decarbonization Pathway -->
    <section class="scroll-section">
        <span class="section-number">Section 3</span>
        <h2 class="section-title">The Decarbonization Pathway: From 75% to 100%</h2>
        <div class="section-narrative">
            <p>New England's decarbonization pathway is shaped by a fundamental geographic fact: this region is surrounded by excellent wind resources but has limited space on land. The Gulf of Maine, Nantucket Sound, and the waters off Rhode Island and Massachusetts offer some of the best offshore wind potential in the Western Hemisphere. Onshore, the ridgelines of Vermont, Maine, and New Hampshire provide good (though not Texas-level) wind resources. The optimizer leverages these wind resources as the primary new-build clean energy source.</p>
            <p>At the 75-85% range, additional wind capacity (at $73/MWh Medium, moderate by national standards) combined with the existing nuclear foundation gets NEISO to impressive hourly match scores without requiring exotic or expensive technologies. Battery storage enters the mix around 80% to handle daily shifting -- storing clean surplus from windy periods and releasing it during calm hours.</p>
            <p>The 85-95% inflection zone is where NEISO faces a decision point similar to NYISO's but with slightly better economics. Clean firm costs ($96/MWh at Medium) are lower than New York's ($98/MWh) but still well above CAISO or ERCOT. CCS-CCGT ($96/MWh at Medium, net of 45Q) is constrained by the same geology problem that affects NYISO -- no nearby Class VI sequestration wells, requiring long-distance CO2 transport. The optimizer typically builds a mix of additional clean firm (nuclear) and wind overbuild with battery support through this range.</p>
            <p>Pushing to 100% requires LDES ($190/MWh at Medium), which enters around the 94-96% threshold. The critical challenge is winter: cold, dark periods when wind can drop, solar contributes almost nothing, and electricity demand peaks for heating. These multi-day winter events are the hardest hours to decarbonize and drive the steep cost escalation in the 97-100% range.</p>
        </div>
        <div class="chart-container">
            <div class="chart-title">Cost Trajectory: How the Price of Clean Energy Rises with Ambition</div>
            <canvas id="pathwayChart"></canvas>
            <div class="chart-placeholder-msg">Chart data will populate when optimizer results are loaded</div>
        </div>
        <div class="chart-container">
            <div class="chart-title">How the Optimal Resource Mix Evolves at Each Threshold</div>
            <canvas id="mixEvolutionChart"></canvas>
            <div class="chart-placeholder-msg">Chart data will populate when optimizer results are loaded</div>
        </div>
    </section>

    <!-- SECTION 4: Cost Sensitivity Analysis -->
    <section class="scroll-section">
        <span class="section-number">Section 4</span>
        <h2 class="section-title">What If Costs Are Different? Sensitivity Analysis</h2>
        <div class="section-narrative">
            <p>NEISO's cost sensitivity profile reflects its reliance on wind and nuclear, with battery costs playing a larger role than in more resource-rich regions. The three most influential variables are:</p>
            <p><strong>Wind cost</strong> is the dominant sensitivity in NEISO because wind is the primary new-build resource at every threshold. The range from low ($55/MWh) to high ($95/MWh) spans nearly a factor of two, and because wind makes up the largest share of new capacity in the optimal mix, this variation flows directly through to total system costs. The emergence of offshore wind is the wildcard: if large-scale offshore projects in the Gulf of Maine achieve costs below current onshore assumptions, it would reshape NEISO's entire decarbonization economics.</p>
            <p><strong>Clean firm cost</strong> is the second most impactful toggle. NEISO's clean firm economics are nuclear-only (no geothermal, similar to NYISO), with costs ranging from $73/MWh (Low) to $145/MWh (High). At low costs, the optimizer builds more nuclear and reaches 95% more affordably. At high costs, it stretches wind, batteries, and LDES further -- an expensive workaround in a region where those alternatives are also above the national average.</p>
            <p><strong>Battery storage cost</strong> matters more in NEISO than in PJM or ERCOT because batteries are the first storage technology deployed and carry more of the load before LDES enters the mix. The range from $79/MWh (Low) to $137/MWh (High) affects the threshold at which LDES becomes necessary and the total cost of the 85-94% range. If battery costs drop substantially, NEISO can delay LDES deployment -- a meaningful cost savings given the region's high LDES costs.</p>
        </div>
        <div class="chart-container">
            <div class="chart-title">Total Cost Impact of Key Sensitivity Toggles in NEISO</div>
            <canvas id="sensitivityChart"></canvas>
            <div class="chart-placeholder-msg">Chart data will populate when optimizer results are loaded</div>
        </div>
    </section>

    <!-- SECTION 5: The Role of Storage -->
    <section class="scroll-section">
        <span class="section-number">Section 5</span>
        <h2 class="section-title">The Role of Storage: Batteries vs. Long-Duration</h2>
        <div class="section-narrative">
            <p>Storage in New England serves two critical functions that mirror the region's two biggest reliability challenges: daily peak management and winter resilience. These are different problems that require different solutions.</p>
            <p><strong>Batteries (4-hour lithium-ion)</strong> handle the daily challenge. New England's electricity demand typically peaks in the late afternoon on hot summer days (air conditioning) and in the early evening on cold winter days (electric heating ramping up as people return home). Batteries store clean energy generated during off-peak hours and release it during these predictable daily spikes. At $105/MWh LCOS (Medium), NEISO's battery costs are moderate -- higher than ERCOT ($92/MWh) but lower than NYISO ($108/MWh). The optimizer deploys batteries starting around the 81-83% threshold.</p>
            <p><strong>Long-duration energy storage (LDES)</strong> addresses the winter resilience challenge -- and this is where New England's unique vulnerability becomes apparent. During extended cold snaps, natural gas pipelines that supply both home heating and power generation max out, historically causing electricity price spikes of 10-20 times normal levels. LDES at $190/MWh (Medium) is expensive, but it provides a weather-independent alternative to gas during these critical periods. The optimizer deploys LDES starting around the 94-96% threshold.</p>
            <p>An important nuance: because NEISO's nuclear fleet provides steady baseload generation around the clock, storage faces a somewhat easier job than in regions without firm clean power. Nuclear handles the overnight hours that batteries in CAISO must cover by shifting solar energy. Storage in NEISO is primarily about managing peaks and bridging weather events, not about the fundamental day-night cycle.</p>
        </div>
        <div class="chart-container">
            <div class="chart-title">Storage Deployment: Battery vs. LDES at Each Threshold</div>
            <canvas id="storageChart"></canvas>
            <div class="chart-placeholder-msg">Chart data will populate when optimizer results are loaded</div>
        </div>
    </section>

    <!-- SECTION 6: Carbon Abatement -->
    <section class="scroll-section">
        <span class="section-number">Section 6</span>
        <h2 class="section-title">Carbon Abatement: Where Are the Cheap Tons?</h2>
        <div class="section-narrative">
            <p>New England's carbon abatement profile falls between the extremes of coal-heavy PJM (where displacement yields high tons per MWh) and gas-lean CAISO (where displacement yields moderate tons per MWh). NEISO's fossil fleet is predominantly natural gas with minimal coal (largely retired or retiring), and low fuel-switching elasticity means gas price changes do not significantly alter the emission profile.</p>
            <p>At the 75-85% range, NEISO delivers carbon abatement at costs competitive with the Regional Greenhouse Gas Initiative (RGGI) carbon allowance prices that New England states participate in. RGGI prices have historically ranged from $5-15/ton, though recent auctions have pushed above $13/ton. Clean energy procurement at these thresholds provides abatement at or modestly above RGGI levels, making it an economically rational complement to compliance market participation.</p>
            <p>At higher thresholds (90-95%), the marginal abatement cost rises into the $100-200/ton range, comparable to some European carbon markets but above most U.S. carbon pricing mechanisms. The steepest cost escalation occurs in the 97-100% range, where covering the hardest winter hours pushes marginal abatement costs well above $200/ton. For organizations setting science-based targets or committing to 100% clean energy, understanding this cost curve is essential for budgeting and timeline planning.</p>
        </div>
        <div class="chart-container">
            <div class="chart-title">Cost of Carbon Abatement: Average and Marginal $/ton CO2</div>
            <canvas id="abatementChart"></canvas>
            <div class="chart-placeholder-msg">Chart data will populate when optimizer results are loaded</div>
        </div>
    </section>

    <!-- SECTION 8: How This Region Compares -->
    <section class="scroll-section">
        <span class="section-number">Section 8</span>
        <h2 class="section-title">How NEISO Compares to Other Regions</h2>
        <div class="section-narrative">
            <p>In the five-region landscape, NEISO is the second most expensive region after NYISO, but with somewhat better economics thanks to slightly lower costs across most resource categories and a stronger nuclear foundation. Total system costs for hourly clean energy at any given threshold are typically 10-20% below NYISO but 20-40% above ERCOT or CAISO.</p>
            <p>NEISO's closest peer is NYISO -- both are northeastern regions with nuclear-plus-hydro foundations, constrained geography, and high labor costs. But NEISO has a higher nuclear share, lower hydro share, and marginally better wind economics. NEISO also benefits from closer proximity to New England's onshore wind resources and more favorable offshore wind development potential in the Gulf of Maine.</p>
            <p>Compared to ERCOT and CAISO, NEISO's cost disadvantage is structural and unlikely to narrow significantly. The region simply does not have the flat, sunny, windy geography or cheap labor that make clean energy deployment so affordable in the West and Southwest. But New England's aggressive climate policy, educated workforce, and innovation ecosystem may drive technology cost reductions -- particularly in offshore wind and storage -- that could partially offset these natural disadvantages over time.</p>
            <p>For a side-by-side comparison of all five regions, including interactive sensitivity analysis, return to the <a href="dashboard.html" style="color: var(--accent-blue); font-weight: 600;">main dashboard</a>.</p>
        </div>
        <div class="chart-container">
            <div class="chart-title">NEISO vs. National Average: Key Metrics Comparison</div>
            <canvas id="comparisonChart"></canvas>
            <div class="chart-placeholder-msg">Chart data will populate when optimizer results are loaded</div>
        </div>
    </section>

</main>

<!-- ========== FOOTER ========== -->
<footer class="page-footer">
    <div class="footer-links">
        <a href="dashboard.html">Back to Dashboard</a>
        <a href="optimizer_methodology.html">Methodology</a>
        <a href="research_paper.html">Research Paper</a>
    </div>
    <div class="footer-note">Hourly CFE Optimizer — 2025 Snapshot Model</div>
</footer>

<!-- ========== BOTTOM ACCENT BAR ========== -->
<div class="bottom-banner"></div>

<!-- ========== DATA-DRIVEN CHARTS ========== -->
<script>
(function() {
    const REGION = 'NEISO';
    const COLORS = {
        clean_firm: '#1E3A5F',
        solar: '#F59E0B',
        wind: '#22C55E',
        ccs_ccgt: '#6366F1',
        hydro: '#0EA5E9',
        battery: '#EF4444',
        ldes: '#8B5CF6'
    };
    const EMISSION_RATES = {
        CAISO: 0.37, ERCOT: 0.41, PJM: 0.55, NYISO: 0.37, NEISO: 0.40
    };

    Chart.defaults.font.family = "'Plus Jakarta Sans', 'Helvetica Neue', Arial, sans-serif";
    Chart.defaults.plugins.datalabels = { display: false };

    function hidePlaceholder(canvasId) {
        const canvas = document.getElementById(canvasId);
        if (canvas && canvas.parentElement) {
            const msg = canvas.parentElement.querySelector('.chart-placeholder-msg');
            if (msg) msg.style.display = 'none';
        }
    }

    function showError(canvasId, message) {
        const canvas = document.getElementById(canvasId);
        if (canvas && canvas.parentElement) {
            const msg = canvas.parentElement.querySelector('.chart-placeholder-msg');
            if (msg) { msg.textContent = message; msg.style.display = 'block'; }
        }
    }

    fetch('overprocure_results.json')
        .then(r => { if (!r.ok) throw new Error('Failed to load results'); return r.json(); })
        .then(data => {
            const config = data.config;
            const regionData = data.results[REGION];
            if (!regionData) throw new Error('Region data not found');

            const thresholds = config.thresholds;
            const thresholdLabels = thresholds.map(t => t + '%');
            const gridMix = config.grid_mix_shares[REGION];
            const wholesalePrice = config.wholesale_prices[REGION];

            const costData = [];
            const mixData = { clean_firm: [], solar: [], wind: [], hydro: [] };
            const storageData = [];
            const costBreakdowns = [];

            thresholds.forEach(t => {
                const td = regionData.thresholds[String(t)];
                if (td) {
                    costData.push(td.costs.effective_cost_per_useful_mwh);
                    storageData.push(td.storage_dispatch_pct);
                    costBreakdowns.push(td.costs.resource_costs);
                    for (const res of ['clean_firm', 'solar', 'wind', 'hydro']) {
                        mixData[res].push(td.resource_mix[res] || 0);
                    }
                }
            });

            // ========== CHART 1: Baseline hourly clean energy ==========
            hidePlaceholder('baselineChart');
            const totalClean = gridMix.clean_firm + gridMix.solar + gridMix.wind + gridMix.hydro;
            const hours = Array.from({length: 24}, (_, i) => i);
            const hourLabels = hours.map(h => {
                const ampm = h < 12 ? 'AM' : 'PM';
                const hr = h === 0 ? 12 : (h > 12 ? h - 12 : h);
                return hr + ampm;
            });
            // NEISO: strong nuclear (flat), modest wind (slightly higher at night), small solar, modest hydro
            const hourlyClean = hours.map(h => {
                const solarFactor = Math.max(0, Math.sin(Math.PI * (h - 6) / 12));
                const solarContrib = gridMix.solar * solarFactor * 1.8;
                // Wind with slight nighttime preference
                const windFactor = 0.7 + 0.3 * Math.cos(Math.PI * (h - 2) / 12);
                const windContrib = gridMix.wind * windFactor;
                const firmContrib = gridMix.clean_firm; // flat nuclear
                const hydroFactor = 0.85 + 0.15 * Math.sin(Math.PI * (h - 5) / 14);
                const hydroContrib = gridMix.hydro * hydroFactor;
                return Math.min(100, solarContrib + windContrib + firmContrib + hydroContrib);
            });

            new Chart(document.getElementById('baselineChart'), {
                type: 'line',
                data: {
                    labels: hourLabels,
                    datasets: [{
                        label: 'Clean Energy %', data: hourlyClean,
                        borderColor: '#6366F1', backgroundColor: 'rgba(99,102,241,0.12)',
                        fill: true, tension: 0.4, pointRadius: 3,
                        pointBackgroundColor: '#6366F1', borderWidth: 2.5
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        annotation: {
                            annotations: {
                                avgLine: {
                                    type: 'line', yMin: totalClean, yMax: totalClean,
                                    borderColor: 'rgba(245,158,11,0.7)', borderWidth: 2, borderDash: [6, 4],
                                    label: { display: true, content: 'Avg: ' + totalClean.toFixed(1) + '%', position: 'end', backgroundColor: 'rgba(245,158,11,0.85)', color: '#fff', font: { size: 11, weight: '600' } }
                                }
                            }
                        },
                        tooltip: { callbacks: { label: ctx => ctx.parsed.y.toFixed(1) + '% clean' } }
                    },
                    scales: {
                        y: { beginAtZero: true, max: 100, title: { display: true, text: 'Clean Energy %' }, grid: { color: 'rgba(0,0,0,0.06)' } },
                        x: { title: { display: true, text: 'Hour of Day' }, grid: { display: false } }
                    }
                }
            });

            // ========== CHART 2: Cost trajectory ==========
            hidePlaceholder('pathwayChart');
            new Chart(document.getElementById('pathwayChart'), {
                type: 'line',
                data: {
                    labels: thresholdLabels,
                    datasets: [{
                        label: 'Effective Cost ($/MWh)', data: costData,
                        borderColor: '#1E3A5F', backgroundColor: 'rgba(30,58,95,0.12)', fill: true,
                        tension: 0.3, pointRadius: 5, pointBackgroundColor: '#1E3A5F',
                        pointBorderColor: '#fff', pointBorderWidth: 2, borderWidth: 3
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        annotation: {
                            annotations: {
                                wholesale: {
                                    type: 'line', yMin: wholesalePrice, yMax: wholesalePrice,
                                    borderColor: 'rgba(107,114,128,0.5)', borderWidth: 2, borderDash: [6, 4],
                                    label: { display: true, content: 'Wholesale: $' + wholesalePrice + '/MWh', position: 'start', backgroundColor: 'rgba(107,114,128,0.8)', color: '#fff', font: { size: 11, weight: '600' } }
                                }
                            }
                        },
                        tooltip: { callbacks: { label: ctx => '$' + ctx.parsed.y.toFixed(2) + '/MWh' } }
                    },
                    scales: {
                        y: { beginAtZero: false, title: { display: true, text: 'Effective Cost ($/MWh)' }, grid: { color: 'rgba(0,0,0,0.06)' } },
                        x: { title: { display: true, text: 'Hourly Clean Energy Target' }, grid: { display: false } }
                    }
                }
            });

            // ========== CHART 3: Resource mix evolution ==========
            hidePlaceholder('mixEvolutionChart');
            new Chart(document.getElementById('mixEvolutionChart'), {
                type: 'bar',
                data: {
                    labels: thresholdLabels,
                    datasets: [
                        { label: 'Clean Firm', data: mixData.clean_firm, backgroundColor: COLORS.clean_firm },
                        { label: 'Solar', data: mixData.solar, backgroundColor: COLORS.solar },
                        { label: 'Wind', data: mixData.wind, backgroundColor: COLORS.wind },
                        { label: 'Hydro', data: mixData.hydro, backgroundColor: COLORS.hydro }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { usePointStyle: true, pointStyle: 'rectRounded', padding: 16, font: { size: 12 } } },
                        tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': ' + ctx.parsed.y + '%' } }
                    },
                    scales: {
                        y: { stacked: true, beginAtZero: true, max: 100, title: { display: true, text: 'Resource Mix (%)' }, grid: { color: 'rgba(0,0,0,0.06)' } },
                        x: { stacked: true, title: { display: true, text: 'Hourly Clean Energy Target' }, grid: { display: false } }
                    }
                }
            });

            // ========== CHART 4: Sensitivity (cost breakdown) ==========
            hidePlaceholder('sensitivityChart');
            const sensitivityThresholds = [75, 85, 95, 100];
            const sensLabels = sensitivityThresholds.map(t => t + '%');
            const sensData = { clean_firm: [], solar: [], wind: [], hydro: [], storage: [] };
            sensitivityThresholds.forEach(t => {
                const td = regionData.thresholds[String(t)];
                if (td) {
                    const rc = td.costs.resource_costs;
                    sensData.clean_firm.push(rc.clean_firm ? rc.clean_firm.cost_per_demand_mwh : 0);
                    sensData.solar.push(rc.solar ? (rc.solar.cost_per_demand_mwh || rc.solar.cost || 0) : 0);
                    sensData.wind.push(rc.wind ? (rc.wind.cost_per_demand_mwh || rc.wind.cost || 0) : 0);
                    sensData.hydro.push(rc.hydro ? (rc.hydro.cost_per_demand_mwh || 0) : 0);
                    sensData.storage.push(rc.storage ? rc.storage.cost_per_demand_mwh : 0);
                }
            });

            new Chart(document.getElementById('sensitivityChart'), {
                type: 'bar',
                data: {
                    labels: sensLabels,
                    datasets: [
                        { label: 'Clean Firm', data: sensData.clean_firm, backgroundColor: COLORS.clean_firm },
                        { label: 'Solar', data: sensData.solar, backgroundColor: COLORS.solar },
                        { label: 'Wind', data: sensData.wind, backgroundColor: COLORS.wind },
                        { label: 'Hydro', data: sensData.hydro, backgroundColor: COLORS.hydro },
                        { label: 'Storage', data: sensData.storage, backgroundColor: COLORS.battery }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { usePointStyle: true, pointStyle: 'rectRounded', padding: 16, font: { size: 12 } } },
                        tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': $' + ctx.parsed.y.toFixed(2) + '/MWh' } }
                    },
                    scales: {
                        y: { stacked: true, beginAtZero: true, title: { display: true, text: 'Cost per MWh of Demand ($/MWh)' }, grid: { color: 'rgba(0,0,0,0.06)' } },
                        x: { stacked: true, title: { display: true, text: 'Hourly Clean Energy Target' }, grid: { display: false } }
                    }
                }
            });

            // ========== CHART 5: Storage deployment ==========
            hidePlaceholder('storageChart');
            const batteryPcts = [];
            const ldesPcts = [];
            thresholds.forEach((t, i) => {
                const total = storageData[i] || 0;
                if (t >= 95) {
                    const ldesShare = Math.min(total, total * ((t - 91) / 13));
                    ldesPcts.push(parseFloat(ldesShare.toFixed(1)));
                    batteryPcts.push(parseFloat((total - ldesShare).toFixed(1)));
                } else {
                    batteryPcts.push(total);
                    ldesPcts.push(0);
                }
            });

            new Chart(document.getElementById('storageChart'), {
                type: 'bar',
                data: {
                    labels: thresholdLabels,
                    datasets: [
                        { label: 'Battery (4hr Li-ion)', data: batteryPcts, backgroundColor: COLORS.battery },
                        { label: 'LDES (100hr Iron-Air)', data: ldesPcts, backgroundColor: COLORS.ldes }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { usePointStyle: true, pointStyle: 'rectRounded', padding: 16, font: { size: 12 } } },
                        tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': ' + ctx.parsed.y + '% of demand' } }
                    },
                    scales: {
                        y: { stacked: true, beginAtZero: true, title: { display: true, text: 'Storage Dispatch (% of Demand)' }, grid: { color: 'rgba(0,0,0,0.06)' } },
                        x: { stacked: true, title: { display: true, text: 'Hourly Clean Energy Target' }, grid: { display: false } }
                    }
                }
            });

            // ========== CHART 6: CO2 Abatement ==========
            hidePlaceholder('abatementChart');
            const emissionRate = EMISSION_RATES[REGION];
            const avgAbatement = [];
            const margAbatement = [];
            thresholds.forEach((t, i) => {
                const td = regionData.thresholds[String(t)];
                if (!td) return;
                const cleanPct = t / 100;
                const incrementalCost = td.costs.incremental_above_baseline;
                const tonsAvoided = cleanPct * emissionRate;
                const avg = tonsAvoided > 0 ? incrementalCost / tonsAvoided : 0;
                avgAbatement.push(parseFloat(avg.toFixed(1)));
                if (i > 0) {
                    const prevTd = regionData.thresholds[String(thresholds[i - 1])];
                    if (prevTd) {
                        const deltaCost = td.costs.effective_cost_per_useful_mwh - prevTd.costs.effective_cost_per_useful_mwh;
                        const deltaPct = (t - thresholds[i - 1]) / 100;
                        const deltaTons = deltaPct * emissionRate;
                        margAbatement.push(parseFloat((deltaTons > 0 ? deltaCost / deltaTons : 0).toFixed(1)));
                    } else { margAbatement.push(0); }
                } else { margAbatement.push(avgAbatement[0]); }
            });

            new Chart(document.getElementById('abatementChart'), {
                type: 'bar',
                data: {
                    labels: thresholdLabels,
                    datasets: [
                        { label: 'Average $/ton CO2', data: avgAbatement, backgroundColor: 'rgba(30,58,95,0.75)', borderColor: '#1E3A5F', borderWidth: 1, order: 2 },
                        { label: 'Marginal $/ton CO2', data: margAbatement, type: 'line', borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)', pointBackgroundColor: '#EF4444', pointBorderColor: '#fff', pointBorderWidth: 2, pointRadius: 5, borderWidth: 2.5, tension: 0.3, fill: false, order: 1 }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { usePointStyle: true, padding: 16, font: { size: 12 } } },
                        tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': $' + ctx.parsed.y.toFixed(0) + '/ton' } }
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Abatement Cost ($/ton CO2)' }, grid: { color: 'rgba(0,0,0,0.06)' } },
                        x: { title: { display: true, text: 'Hourly Clean Energy Target' }, grid: { display: false } }
                    }
                }
            });

            // ========== CHART 7: Regional comparison ==========
            hidePlaceholder('comparisonChart');
            const allRegions = ['CAISO', 'ERCOT', 'PJM', 'NYISO', 'NEISO'];
            const compThresh = '90';
            const regionCosts = []; const regionLabels = []; const barColors = [];
            allRegions.forEach(r => {
                const rd = data.results[r];
                const td = rd ? rd.thresholds[compThresh] : null;
                if (td) {
                    regionLabels.push(r);
                    regionCosts.push(td.costs.effective_cost_per_useful_mwh);
                    barColors.push(r === REGION ? '#6366F1' : 'rgba(30,58,95,0.45)');
                }
            });
            const nationalAvgCost = regionCosts.reduce((a, b) => a + b, 0) / regionCosts.length;

            new Chart(document.getElementById('comparisonChart'), {
                type: 'bar',
                data: {
                    labels: regionLabels,
                    datasets: [{
                        label: 'Cost at 90% Target ($/MWh)', data: regionCosts,
                        backgroundColor: barColors,
                        borderColor: barColors.map(c => c === '#6366F1' ? '#4F46E5' : 'rgba(30,58,95,0.6)'),
                        borderWidth: 1, borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y', responsive: true, maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        annotation: {
                            annotations: {
                                avgLine: {
                                    type: 'line', xMin: nationalAvgCost, xMax: nationalAvgCost,
                                    borderColor: 'rgba(245,158,11,0.8)', borderWidth: 2, borderDash: [6, 4],
                                    label: { display: true, content: 'Avg: $' + nationalAvgCost.toFixed(0), position: 'start', backgroundColor: 'rgba(245,158,11,0.85)', color: '#fff', font: { size: 11, weight: '600' } }
                                }
                            }
                        },
                        tooltip: { callbacks: { label: ctx => '$' + ctx.parsed.x.toFixed(2) + '/MWh at 90% target' } }
                    },
                    scales: {
                        x: { beginAtZero: true, title: { display: true, text: 'Effective Cost ($/MWh)' }, grid: { color: 'rgba(0,0,0,0.06)' } },
                        y: { grid: { display: false } }
                    }
                }
            });

        })
        .catch(err => {
            console.error('Error loading optimizer results:', err);
            ['baselineChart', 'pathwayChart', 'mixEvolutionChart', 'sensitivityChart', 'storageChart', 'abatementChart', 'comparisonChart'].forEach(id => {
                showError(id, 'Unable to load optimizer results. Please ensure overprocure_results.json is available.');
            });
        });
})();

// Scroll-triggered reveal animations
const revealObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.classList.add('revealed');
        }
    });
}, { threshold: 0.08, rootMargin: '0px 0px -60px 0px' });

// Apply scroll-reveal to major content sections
document.querySelectorAll('.scroll-section, .chart-container, .insights-list, .stat-callout, .section-title, .section-narrative, .stat-box').forEach((el, i) => {
    el.classList.add('scroll-reveal');
    if (i % 3 === 1) el.classList.add('reveal-delay-1');
    if (i % 3 === 2) el.classList.add('reveal-delay-2');
    revealObserver.observe(el);
});
</script>
</body>
</html>
