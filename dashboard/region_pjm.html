<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PJM Deep Dive — Hourly CFE Optimizer</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Rajdhani:wght@400;500;600;700&family=Barlow+Semi+Condensed:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
@font-face {
    font-family: 'Franklin Gothic Demi';
    src: local('Franklin Gothic Demi'), local('Franklin Gothic Medium'), local('ITC Franklin Gothic Demi'), local('Franklin Gothic Demi Cond');
    font-weight: 600;
    font-style: normal;
    font-display: swap;
}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
<style>
/* ========== RESET & BASE ========== */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html {
    font-size: 17px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    scroll-behavior: smooth;
}

body {
    font-family: 'Plus Jakarta Sans', 'Helvetica Neue', Arial, sans-serif;
    background: #0F1A2E;
    background-image:
        radial-gradient(ellipse at 20% 0%, rgba(14,165,233,0.06) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 100%, rgba(245,158,11,0.04) 0%, transparent 50%);
    background-attachment: fixed;
    color: #000000;
    line-height: 1.55;
    min-height: 100vh;
}

:root {
    --navy: #1A2744;
    --navy-light: #2D3A52;
    --bg-card: #FFFFFF;
    --bg-card-hover: #F7F8FA;
    --border: #D4D8E0;
    --border-light: #E5E7EB;
    --text-primary: #000000;
    --text-secondary: #000000;
    --text-muted: #6B7280;
    --clean-firm: #1E3A5F;
    --solar: #F59E0B;
    --wind: #22C55E;
    --hydro: #0EA5E9;
    --storage: #EF4444;
    --accent-blue: #4a90d9;
    --accent-warm: #f4a261;
}

/* ========== TOP NAVIGATION BAR ========== */
.top-nav {
    background: #1a1a2e;
    padding: 0 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: sticky;
    top: 0;
    z-index: 999;
    border-bottom: 1px solid rgba(255,255,255,0.08);
    min-height: 48px;
}
.top-nav-inner {
    display: flex;
    align-items: center;
    gap: 0;
    max-width: 1440px;
    width: 100%;
    justify-content: center;
}
.top-nav a {
    color: rgba(255,255,255,0.75);
    text-decoration: none;
    font-family: 'Franklin Gothic Demi', 'Barlow Semi Condensed', 'Arial Narrow', sans-serif;
    font-size: 0.85rem;
    font-weight: 600;
    letter-spacing: 0.04em;
    padding: 14px 18px;
    transition: color 0.2s, background 0.2s, border-color 0.2s;
    border-bottom: 3px solid transparent;
    white-space: nowrap;
}
.top-nav a:hover {
    color: #ffffff;
    background: rgba(255,255,255,0.06);
}
.top-nav a.nav-active {
    color: #ffffff;
    border-bottom-color: #0EA5E9;
    background: rgba(14,165,233,0.1);
}
.nav-hamburger {
    display: none;
    background: none;
    border: none;
    color: #ffffff;
    font-size: 1.5rem;
    cursor: pointer;
    padding: 10px;
    min-width: 44px;
    min-height: 44px;
    align-items: center;
    justify-content: center;
}
.nav-hamburger svg {
    width: 24px;
    height: 24px;
    stroke: currentColor;
    stroke-width: 2;
    fill: none;
}
@media (max-width: 768px) {
    .top-nav {
        flex-wrap: wrap;
        padding: 0 12px;
        justify-content: space-between;
    }
    .top-nav-inner {
        display: none;
        flex-direction: column;
        width: 100%;
        padding-bottom: 8px;
    }
    .top-nav-inner.nav-open {
        display: flex;
    }
    .top-nav a {
        padding: 12px 16px;
        border-bottom: none;
        border-left: 3px solid transparent;
        width: 100%;
        text-align: left;
    }
    .top-nav a.nav-active {
        border-left-color: #0EA5E9;
        border-bottom: none;
        background: rgba(14,165,233,0.12);
    }
    .nav-hamburger {
        display: flex;
    }
    .nav-brand {
        display: flex;
        align-items: center;
        color: #ffffff;
        font-family: 'Franklin Gothic Demi', 'Barlow Semi Condensed', sans-serif;
        font-size: 0.9rem;
        font-weight: 700;
        letter-spacing: 0.03em;
        padding: 12px 0;
    }
}
@media (min-width: 769px) {
    .nav-brand { display: none; }
}

/* ========== HEADER BANNER ========== */
.header {
    background: linear-gradient(135deg, #0F1A2E 0%, #122952 30%, #1565C0 70%, #0D47A1 100%);
    color: #ffffff;
    padding: 90px 24px 80px;
    text-align: center;
    position: relative;
    overflow: hidden;
}
.header::before {
    content: '';
    position: absolute;
    inset: 0;
    z-index: 1;
    pointer-events: none;
    background:
        radial-gradient(ellipse 55% 70% at 12% 75%, rgba(14,165,233,0.4) 0%, transparent 65%),
        radial-gradient(ellipse 45% 60% at 38% 85%, rgba(34,197,94,0.35) 0%, transparent 60%),
        radial-gradient(ellipse 50% 65% at 62% 80%, rgba(245,158,11,0.35) 0%, transparent 60%),
        radial-gradient(ellipse 40% 55% at 88% 70%, rgba(239,68,68,0.3) 0%, transparent 55%);
}
.header::after {
    content: '';
    position: absolute;
    inset: 0;
    z-index: 1;
    pointer-events: none;
    background: radial-gradient(ellipse 70% 45% at 50% 45%, rgba(5,15,35,0.55) 0%, transparent 100%);
}
.header-accent {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #1A2744 0%, #0EA5E9 25%, #22C55E 50%, #F59E0B 75%, #EF4444 100%);
    z-index: 2;
}
.header h1 {
    font-family: 'Franklin Gothic Demi', 'Lexend', 'Rajdhani', 'Arial Narrow', 'Helvetica Neue', Arial, sans-serif;
    font-weight: 700;
    font-size: 3.2rem;
    letter-spacing: 0.5px;
    text-transform: none;
    margin-bottom: 14px;
    position: relative;
    z-index: 3;
    text-shadow: 0 2px 20px rgba(0,0,0,0.5), 0 1px 3px rgba(0,0,0,0.3);
    line-height: 1.15;
}
.header .subtitle {
    font-family: 'Plus Jakarta Sans', 'Helvetica Neue', Arial, sans-serif;
    font-size: 1.15rem;
    font-weight: 400;
    opacity: 0.92;
    max-width: 660px;
    margin: 0 auto;
    letter-spacing: 0.2px;
    position: relative;
    z-index: 3;
    text-shadow: 0 2px 12px rgba(0,0,0,0.4), 0 1px 2px rgba(0,0,0,0.2);
    line-height: 1.55;
}

/* ========== MAIN CONTENT ========== */
.main-content {
    max-width: 1440px;
    margin: 0 auto;
    padding: 0;
    background: #F3F4F8;
}

/* ========== SCROLLYTELLING SECTIONS ========== */
.scroll-section {
    min-height: 80vh;
    padding: 80px 44px;
    border-bottom: 1px solid var(--border-light);
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
}
.scroll-section:last-child {
    border-bottom: none;
}
.scroll-section:nth-child(even) {
    background: #FFFFFF;
}
.scroll-section:nth-child(odd) {
    background: #F3F4F8;
}
.section-number {
    font-family: 'Franklin Gothic Demi', 'Barlow Semi Condensed', sans-serif;
    font-size: 0.78rem;
    font-weight: 700;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--accent-blue);
    margin-bottom: 12px;
}
.section-title {
    font-family: 'Franklin Gothic Demi', 'Lexend', 'Rajdhani', 'Arial Narrow', sans-serif;
    font-weight: 700;
    font-size: 2.2rem;
    color: var(--navy);
    margin-bottom: 32px;
    text-align: center;
    line-height: 1.2;
    max-width: 800px;
}
.section-narrative {
    max-width: 800px;
    font-size: 1.06rem;
    line-height: 1.75;
    color: var(--text-primary);
    margin-bottom: 24px;
}
.section-narrative p {
    margin-bottom: 20px;
}
.section-narrative strong {
    color: var(--navy);
}

/* ========== CHART PLACEHOLDERS ========== */
.chart-container {
    width: 100%;
    max-width: 700px;
    margin: 32px auto;
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: 12px;
    padding: 28px;
    position: relative;
}
.chart-container canvas {
    width: 100% !important;
    height: 350px !important;
}
.chart-container .chart-title {
    font-family: 'Franklin Gothic Demi', 'Barlow Semi Condensed', sans-serif;
    font-weight: 600;
    font-size: 1.0rem;
    color: var(--navy);
    margin-bottom: 16px;
    text-align: center;
}
.chart-placeholder-msg {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: var(--text-muted);
    font-size: 0.9rem;
    font-style: italic;
    text-align: center;
    padding: 20px;
    pointer-events: none;
}

/* ========== KEY INSIGHTS ========== */
.insights-list {
    max-width: 800px;
    list-style: none;
    padding: 0;
}
.insights-list li {
    position: relative;
    padding: 16px 0 16px 36px;
    font-size: 1.06rem;
    line-height: 1.65;
    border-bottom: 1px solid var(--border-light);
}
.insights-list li:last-child {
    border-bottom: none;
}
.insights-list li::before {
    content: '';
    position: absolute;
    left: 0;
    top: 22px;
    width: 18px;
    height: 18px;
    background: var(--accent-blue);
    border-radius: 50%;
    opacity: 0.8;
}

/* ========== STAT CALLOUT ========== */
.stat-callout {
    display: flex;
    gap: 32px;
    flex-wrap: wrap;
    justify-content: center;
    margin: 32px 0;
    max-width: 800px;
}
.stat-box {
    background: linear-gradient(145deg, #f8f9fb 0%, #f0f2f5 100%);
    border: 1px solid var(--border-light);
    border-radius: 10px;
    padding: 24px 32px;
    text-align: center;
    min-width: 160px;
    flex: 1;
    max-width: 220px;
}
.stat-value {
    font-family: 'Franklin Gothic Demi', 'Barlow Semi Condensed', sans-serif;
    font-size: 2rem;
    font-weight: 700;
    color: var(--navy);
    line-height: 1.1;
}
.stat-label {
    font-size: 0.82rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--text-muted);
    margin-top: 6px;
}

/* ========== FOOTER ========== */
.page-footer {
    background: #1a1a2e;
    color: rgba(255,255,255,0.7);
    padding: 48px 24px;
    text-align: center;
}
.footer-links {
    display: flex;
    gap: 24px;
    justify-content: center;
    flex-wrap: wrap;
    margin-bottom: 20px;
}
.footer-links a {
    color: rgba(255,255,255,0.8);
    text-decoration: none;
    font-family: 'Franklin Gothic Demi', 'Barlow Semi Condensed', sans-serif;
    font-size: 0.88rem;
    font-weight: 600;
    letter-spacing: 0.04em;
    padding: 8px 16px;
    border-radius: 6px;
    transition: background 0.2s, color 0.2s;
    min-height: 44px;
    display: flex;
    align-items: center;
}
.footer-links a:hover {
    background: rgba(255,255,255,0.08);
    color: #ffffff;
}
.footer-note {
    font-size: 0.82rem;
    opacity: 0.5;
    margin-top: 12px;
}

/* ========== BOTTOM ACCENT BAR ========== */
.bottom-banner {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 6px;
    background: linear-gradient(90deg, #1A2744 0%, #0EA5E9 25%, #22C55E 50%, #F59E0B 75%, #EF4444 100%);
    z-index: 1000;
}

/* ========== RESPONSIVE ========== */
@media (max-width: 768px) {
    .header { padding: 60px 16px 50px; }
    .header h1 { font-size: 2.2rem; }
    .header .subtitle { font-size: 1rem; }
    .scroll-section { padding: 48px 20px; min-height: auto; }
    .section-title { font-size: 1.7rem; }
    .section-narrative { font-size: 1rem; }
    .chart-container { padding: 16px; }
    .chart-container canvas { height: 260px !important; }
    .stat-callout { gap: 16px; }
    .stat-box { min-width: 130px; padding: 16px 20px; }
    .stat-value { font-size: 1.6rem; }
}
@media (max-width: 480px) {
    .header h1 { font-size: 1.8rem; }
    .stat-callout { flex-direction: column; align-items: center; }
    .stat-box { max-width: 100%; width: 100%; }
}

/* Scroll-triggered animations */
@keyframes fadeSlideUp {
    from { opacity: 0; transform: translateY(40px); }
    to   { opacity: 1; transform: translateY(0); }
}
.scroll-reveal {
    opacity: 0;
    transform: translateY(40px);
    transition: opacity 0.7s cubic-bezier(0.23, 1, 0.32, 1), transform 0.7s cubic-bezier(0.23, 1, 0.32, 1);
}
.scroll-reveal.revealed {
    opacity: 1;
    transform: translateY(0);
}
.scroll-reveal.reveal-delay-1 { transition-delay: 0.15s; }
.scroll-reveal.reveal-delay-2 { transition-delay: 0.3s; }
.scroll-reveal.reveal-delay-3 { transition-delay: 0.45s; }
.scroll-section {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.scroll-section:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.08);
}
@media (prefers-reduced-motion: reduce) {
    .scroll-reveal { opacity: 1; transform: none; transition: none; }
    .scroll-section:hover { transform: none; box-shadow: none; }
}
</style>
</head>
<body>

<!-- ========== TOP NAVIGATION ========== -->
<nav class="top-nav">
    <span class="nav-brand">Hourly CFE Optimizer</span>
    <button class="nav-hamburger" onclick="document.querySelector('.top-nav-inner').classList.toggle('nav-open')" aria-label="Toggle navigation">
        <svg viewBox="0 0 24 24"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
    </button>
    <div class="top-nav-inner">
        <a href="dashboard.html">Dashboard</a>
        <a href="region_caiso.html">CAISO</a>
        <a href="region_ercot.html">ERCOT</a>
        <a href="region_pjm.html" class="nav-active">PJM</a>
        <a href="region_nyiso.html">NYISO</a>
        <a href="region_neiso.html">NEISO</a>
        <a href="optimizer_methodology.html">Methodology</a>
        <a href="research_paper.html">Paper</a>
    </div>
</nav>

<!-- ========== HEADER BANNER ========== -->
<header class="header">
    <h1>PJM Deep Dive</h1>
    <p class="subtitle">Mid-Atlantic Clean Energy Transition</p>
    <div class="header-accent"></div>
</header>

<!-- ========== MAIN CONTENT ========== -->
<main class="main-content">

    <!-- SECTION 1: Region Overview -->
    <section class="scroll-section">
        <span class="section-number">Section 1</span>
        <h2 class="section-title">The Mid-Atlantic Grid at a Glance</h2>
        <div class="section-narrative">
            <p>PJM Interconnection is the largest wholesale electricity market in the United States, serving 65 million people across 13 states and the District of Columbia. Stretching from New Jersey to Illinois, from Virginia to Michigan, PJM is the backbone of the American industrial heartland. Its grid powers data centers in Northern Virginia, steel mills in Pennsylvania, and office towers from Philadelphia to Chicago.</p>
            <p>What makes PJM unique -- and critically important for the clean energy transition -- is its <strong>massive nuclear fleet</strong>. With 32.1% of all generation coming from nuclear power plants, PJM has the highest share of clean firm generation of any region in this study. These are plants like Limerick, Peach Bottom, and Calvert Cliffs -- facilities that produce carbon-free electricity around the clock, rain or shine, wind or calm. In the language of hourly matching, nuclear is the ultimate clean baseload resource.</p>
            <p>But PJM also carries a legacy that complicates its clean energy story. The region still operates a substantial coal fleet (roughly 45 GW), making it the most coal-dependent of the five regions we analyze. This coal capacity creates both a challenge and an opportunity: a challenge because coal plants are the highest-emitting generators on the grid, and an opportunity because displacing coal yields more carbon reduction per megawatt-hour than displacing natural gas. PJM's renewable portfolio is still small -- just 2.9% solar and 3.8% wind -- but growing rapidly as developers target the region's vast demand base.</p>
        </div>
        <div class="stat-callout">
            <div class="stat-box">
                <div class="stat-value">32.1%</div>
                <div class="stat-label">Clean Firm</div>
            </div>
            <div class="stat-box">
                <div class="stat-value">3.8%</div>
                <div class="stat-label">Wind Share</div>
            </div>
            <div class="stat-box">
                <div class="stat-value">2.9%</div>
                <div class="stat-label">Solar Share</div>
            </div>
            <div class="stat-box">
                <div class="stat-value">1.8%</div>
                <div class="stat-label">Hydro Share</div>
            </div>
        </div>
    </section>

    <!-- SECTION 2: Today's Starting Point -->
    <section class="scroll-section">
        <span class="section-number">Section 2</span>
        <h2 class="section-title">Today's Starting Point: What the Existing Grid Delivers</h2>
        <div class="section-narrative">
            <p>Thanks to its nuclear fleet, PJM starts from a remarkably strong position for hourly clean energy matching. Nuclear plants operate continuously at high capacity factors -- typically 90% or above -- meaning they deliver clean energy during every single hour of the year. This is fundamentally different from solar or wind, which only produce during certain hours.</p>
            <p>Imagine you are trying to fill a 24-hour day with clean energy. In CAISO, you get a big burst from solar during the middle of the day but almost nothing at night. In ERCOT, you get variable wind that is strong some nights and weak others. In PJM, nuclear provides a steady, flat foundation that covers roughly a third of every single hour. It is like having a salary versus commission-based income: not as exciting in the good times, but dependably there in the bad times.</p>
            <p>This nuclear foundation means PJM's hourly matching profile is flatter and more predictable than wind- or solar-dependent regions. The remaining gaps -- the hours that nuclear alone cannot cover -- are concentrated in peak demand periods (hot summer afternoons, cold winter evenings) when total electricity consumption exceeds what clean sources can provide. Filling these gaps is the core challenge of PJM's decarbonization pathway.</p>
        </div>
        <div class="chart-container">
            <div class="chart-title">Hourly Clean Energy Match from Existing PJM Grid</div>
            <canvas id="baselineChart"></canvas>
            <div class="chart-placeholder-msg">Chart data will populate when optimizer results are loaded</div>
        </div>
    </section>

    <!-- SECTION 3: The Decarbonization Pathway -->
    <section class="scroll-section">
        <span class="section-number">Section 3</span>
        <h2 class="section-title">The Decarbonization Pathway: From 75% to 100%</h2>
        <div class="section-narrative">
            <p>PJM's decarbonization pathway is fundamentally different from CAISO or ERCOT because it starts from a nuclear-heavy foundation rather than a renewables-heavy one. The first step to reaching 75% hourly clean energy is relatively modest: with 32.1% already coming from nuclear and small contributions from existing wind, solar, and hydro, PJM needs less new capacity than you might expect. Additional wind (PJM has good onshore wind resources, especially in western Pennsylvania and the Great Lakes states) and new solar fill most of the gap to 85%.</p>
            <p>The 85-95% range is where PJM's pathway diverges most from other regions. Because nuclear already covers the baseload hours, the incremental challenge is covering peak demand periods and seasonal variations -- not the nighttime hours that plague solar-heavy grids. <strong>Clean firm resources</strong> (additional nuclear or geothermal) are valuable but more expensive here than in CAISO, since PJM lacks geothermal access and nuclear costs are higher ($93/MWh at Medium).</p>
            <p>An important dynamic unique to PJM is the <strong>coal-to-gas switching effect</strong>. When natural gas prices rise, PJM's substantial coal fleet ramps up to replace gas-fired generation, significantly increasing the grid's emission rate. This high fuel-switching elasticity means gas price assumptions have an outsized impact on the carbon intensity of PJM's grid -- and therefore on how much CO2 each new clean MWh displaces. At high gas prices, the abatement value of clean energy in PJM increases substantially.</p>
            <p>Pushing to 100% requires LDES and additional clean firm, similar to other regions. But PJM's nuclear foundation means less total new capacity is needed compared to regions starting from a lower clean energy share.</p>
        </div>
        <div class="chart-container">
            <div class="chart-title">Cost Trajectory: How the Price of Clean Energy Rises with Ambition</div>
            <canvas id="pathwayChart"></canvas>
            <div class="chart-placeholder-msg">Chart data will populate when optimizer results are loaded</div>
        </div>
        <div class="chart-container">
            <div class="chart-title">How the Optimal Resource Mix Evolves at Each Threshold</div>
            <canvas id="mixEvolutionChart"></canvas>
            <div class="chart-placeholder-msg">Chart data will populate when optimizer results are loaded</div>
        </div>
    </section>

    <!-- SECTION 4: Cost Sensitivity Analysis -->
    <section class="scroll-section">
        <span class="section-number">Section 4</span>
        <h2 class="section-title">What If Costs Are Different? Sensitivity Analysis</h2>
        <div class="section-narrative">
            <p>Three cost assumptions have the largest impact on PJM's hourly clean energy economics. The story here is quite different from the West Coast and Texas, reflecting PJM's unique market structure:</p>
            <p><strong>Clean firm cost</strong> is the most impactful variable in PJM, and the reason is straightforward: nuclear is already the region's dominant clean resource, and more nuclear (or equivalent firm capacity) is the most natural way to extend clean coverage. But PJM's clean firm costs ($93/MWh at Medium) are significantly higher than CAISO's ($78/MWh) because PJM has no geothermal access -- the cost reflects nuclear-only economics. The spread between low ($72/MWh) and high ($140/MWh) scenarios makes a massive difference in total system cost at every threshold above 85%.</p>
            <p><strong>Coal price</strong> is uniquely important in PJM because of the region's large remaining coal fleet (~45 GW). Coal prices affect wholesale electricity costs, which in turn determine the reference price for existing clean resources. More importantly, coal price interacts with gas price to determine the grid's emission rate through fuel-switching dynamics. Cheap coal ($1.80/MMBtu) keeps coal plants running and emissions high, making clean energy displacement more valuable per MWh. Expensive coal ($4.00/MMBtu) accelerates coal retirement and reduces the emission rate -- good for the climate, but it lowers the abatement credit per new clean MWh.</p>
            <p><strong>Wind cost</strong> matters because wind is the primary variable renewable resource in PJM's optimal mix. At $62/MWh (Medium), PJM wind is more expensive than ERCOT's ($40/MWh) but less expensive than NYISO's ($81/MWh). Changes in wind cost shift the balance between wind and solar in the 75-90% range and influence how quickly the optimizer turns to clean firm resources at higher thresholds.</p>
        </div>
        <div class="chart-container">
            <div class="chart-title">Total Cost Impact of Key Sensitivity Toggles in PJM</div>
            <canvas id="sensitivityChart"></canvas>
            <div class="chart-placeholder-msg">Chart data will populate when optimizer results are loaded</div>
        </div>
    </section>

    <!-- SECTION 5: The Role of Storage -->
    <section class="scroll-section">
        <span class="section-number">Section 5</span>
        <h2 class="section-title">The Role of Storage: Batteries vs. Long-Duration</h2>
        <div class="section-narrative">
            <p>Storage plays a supporting role in PJM rather than a starring one, and the reason traces back to nuclear. In solar-heavy CAISO, batteries are essential because they bridge the predictable daily gap between solar peak and evening demand. In wind-heavy ERCOT, LDES matters because it bridges multi-day wind lulls. In PJM, nuclear already provides steady around-the-clock generation, so the storage challenge is more about handling seasonal and peak demand variations than daily or multi-day cycles.</p>
            <p><strong>Batteries (4-hour lithium-ion)</strong> are deployed in PJM primarily for two purposes: capturing midday solar surplus (PJM's solar share is small but growing) and providing peak-shaving during summer afternoon demand spikes. Battery costs in PJM ($98/MWh LCOS at Medium) are moderate -- higher than ERCOT but lower than NYISO -- and the optimizer deploys modest battery fleets starting around the 82-85% threshold.</p>
            <p><strong>Long-duration energy storage (LDES)</strong> enters PJM's optimal mix later than in most other regions, typically around the 94-96% threshold. This delayed entry reflects nuclear's ability to cover baseload hours reliably. When LDES does enter, its role is to store clean energy surplus from high-wind or high-solar periods and release it during sustained cold winter events when demand peaks and renewable output drops. PJM's LDES costs ($170/MWh at Medium) are mid-range nationally.</p>
            <p>The bottom line: PJM buyers should think of storage as a complement to firm generation, not a substitute for it. The nuclear fleet does the heavy lifting; storage handles the peaks and valleys.</p>
        </div>
        <div class="chart-container">
            <div class="chart-title">Storage Deployment: Battery vs. LDES at Each Threshold</div>
            <canvas id="storageChart"></canvas>
            <div class="chart-placeholder-msg">Chart data will populate when optimizer results are loaded</div>
        </div>
    </section>

    <!-- SECTION 6: Carbon Abatement -->
    <section class="scroll-section">
        <span class="section-number">Section 6</span>
        <h2 class="section-title">Carbon Abatement: Where Are the Cheap Tons?</h2>
        <div class="section-narrative">
            <p>PJM offers something no other region in this study can match: <strong>high-carbon-intensity displaced generation</strong>. Because PJM still operates a large coal fleet, the marginal emission rate of fossil generation is significantly higher than in gas-dominated regions like CAISO or ERCOT. Each clean MWh deployed in PJM displaces more CO2 than the same MWh would in any other region we study.</p>
            <p>This means the abatement cost curve in PJM has a favorable shape -- the cost per ton of CO2 avoided is lower than you might expect given PJM's higher clean energy costs, because each MWh does more carbon reduction work. At lower thresholds (75-85%), PJM can deliver carbon abatement at costs competitive with or below major carbon markets.</p>
            <p>However, this advantage diminishes as coal retires. Under high gas price scenarios (which drive coal-to-gas switching and lower the emission rate), the per-ton abatement cost rises because each clean MWh displaces less carbon. This creates a time-sensitive opportunity: clean energy investments made now, while coal still operates on PJM's grid, deliver more abatement value per dollar than the same investments made five or ten years from now after coal has retired.</p>
            <p>At the highest thresholds (95-100%), PJM's marginal abatement costs converge with other regions, as the remaining fossil generation is predominantly natural gas regardless of fuel price assumptions.</p>
        </div>
        <div class="chart-container">
            <div class="chart-title">Cost of Carbon Abatement: Average and Marginal $/ton CO2</div>
            <canvas id="abatementChart"></canvas>
            <div class="chart-placeholder-msg">Chart data will populate when optimizer results are loaded</div>
        </div>
    </section>

    <!-- SECTION 7: Key Insights -->
    <section class="scroll-section">
        <span class="section-number">Section 7</span>
        <h2 class="section-title">Key Insights: What Makes PJM Unique</h2>
        <div class="section-narrative">
            <p>PJM is the most complex market in this study -- the largest, most diverse, and most shaped by legacy fossil infrastructure. Here are the key takeaways for procurement strategists:</p>
        </div>
        <ul class="insights-list">
            <li><strong>Nuclear is the single biggest advantage.</strong> With 32.1% of generation from nuclear, PJM has the strongest around-the-clock clean energy foundation of any region. This means less new capacity is needed to reach moderate hourly matching thresholds (75-85%) compared to regions that must build everything from scratch. Preserving existing nuclear plants is arguably the most cost-effective climate action available in PJM.</li>
            <li><strong>Coal displacement delivers exceptional carbon value.</strong> Every clean MWh deployed in PJM displaces generation with one of the highest emission rates in the country. This makes PJM particularly attractive for corporate buyers who measure decarbonization impact in tons of CO2 avoided, not just percentage of clean energy purchased.</li>
            <li><strong>Fuel-switching dynamics create scenario uncertainty.</strong> PJM's large coal fleet means gas price assumptions significantly change the grid's emission profile. Decision-makers should stress-test their plans against multiple gas/coal price scenarios to understand the range of possible outcomes.</li>
            <li><strong>Clean firm costs are the binding constraint at high thresholds.</strong> Without geothermal access, PJM must rely on nuclear economics for firm clean power -- and new nuclear is expensive. This makes the 95-100% range particularly costly in PJM compared to geothermal-rich California.</li>
            <li><strong>The renewable resource is moderate but improving.</strong> PJM's 2.9% solar and 3.8% wind shares are the lowest among our five regions, but the interconnection queue is massive. As more wind and solar come online, the optimal mix and cost trajectory will shift in favor of these variable resources.</li>
        </ul>
    </section>

    <!-- SECTION 8: How This Region Compares -->
    <section class="scroll-section">
        <span class="section-number">Section 8</span>
        <h2 class="section-title">How PJM Compares to Other Regions</h2>
        <div class="section-narrative">
            <p>PJM occupies a middle ground among the five regions: not the cheapest (that is ERCOT), not the most renewable-rich (that is CAISO), but uniquely positioned thanks to nuclear. Its total system cost at moderate thresholds (80-90%) is competitive because nuclear provides so much clean energy at wholesale prices. At higher thresholds (95-100%), costs rise more steeply than in ERCOT or CAISO due to expensive clean firm alternatives.</p>
            <p>PJM's carbon abatement story is among the strongest in the country. The combination of coal displacement opportunity and a growing renewable pipeline makes it an attractive region for impact-oriented investors and corporate buyers. If your primary goal is maximizing CO2 reduction per dollar spent, PJM deserves serious consideration -- especially at the 75-90% threshold range where the abatement economics are most favorable.</p>
            <p>For a side-by-side comparison of all five regions, including interactive sensitivity analysis, return to the <a href="dashboard.html" style="color: var(--accent-blue); font-weight: 600;">main dashboard</a>.</p>
        </div>
        <div class="chart-container">
            <div class="chart-title">PJM vs. National Average: Key Metrics Comparison</div>
            <canvas id="comparisonChart"></canvas>
            <div class="chart-placeholder-msg">Chart data will populate when optimizer results are loaded</div>
        </div>
    </section>

</main>

<!-- ========== FOOTER ========== -->
<footer class="page-footer">
    <div class="footer-links">
        <a href="dashboard.html">Back to Dashboard</a>
        <a href="optimizer_methodology.html">Methodology</a>
        <a href="research_paper.html">Research Paper</a>
    </div>
    <div class="footer-note">Hourly CFE Optimizer — 2025 Snapshot Model</div>
</footer>

<!-- ========== BOTTOM ACCENT BAR ========== -->
<div class="bottom-banner"></div>

<!-- ========== DATA-DRIVEN CHARTS ========== -->
<script>
(function() {
    const REGION = 'PJM';
    const COLORS = {
        clean_firm: '#1E3A5F',
        solar: '#F59E0B',
        wind: '#22C55E',
        ccs_ccgt: '#6366F1',
        hydro: '#0EA5E9',
        battery: '#EF4444',
        ldes: '#8B5CF6'
    };
    const EMISSION_RATES = {
        CAISO: 0.37, ERCOT: 0.41, PJM: 0.55, NYISO: 0.37, NEISO: 0.40
    };

    Chart.defaults.font.family = "'Plus Jakarta Sans', 'Helvetica Neue', Arial, sans-serif";
    Chart.defaults.plugins.datalabels = { display: false };

    function hidePlaceholder(canvasId) {
        const canvas = document.getElementById(canvasId);
        if (canvas && canvas.parentElement) {
            const msg = canvas.parentElement.querySelector('.chart-placeholder-msg');
            if (msg) msg.style.display = 'none';
        }
    }

    function showError(canvasId, message) {
        const canvas = document.getElementById(canvasId);
        if (canvas && canvas.parentElement) {
            const msg = canvas.parentElement.querySelector('.chart-placeholder-msg');
            if (msg) { msg.textContent = message; msg.style.display = 'block'; }
        }
    }

    fetch('overprocure_results.json')
        .then(r => { if (!r.ok) throw new Error('Failed to load results'); return r.json(); })
        .then(data => {
            const config = data.config;
            const regionData = data.results[REGION];
            if (!regionData) throw new Error('Region data not found');

            const thresholds = config.thresholds;
            const thresholdLabels = thresholds.map(t => t + '%');
            const gridMix = config.grid_mix_shares[REGION];
            const wholesalePrice = config.wholesale_prices[REGION];

            const costData = [];
            const mixData = { clean_firm: [], solar: [], wind: [], hydro: [] };
            const storageData = [];
            const costBreakdowns = [];

            thresholds.forEach(t => {
                const td = regionData.thresholds[String(t)];
                if (td) {
                    costData.push(td.costs.effective_cost_per_useful_mwh);
                    storageData.push(td.storage_dispatch_pct);
                    costBreakdowns.push(td.costs.resource_costs);
                    for (const res of ['clean_firm', 'solar', 'wind', 'hydro']) {
                        mixData[res].push(td.resource_mix[res] || 0);
                    }
                }
            });

            // ========== CHART 1: Baseline hourly clean energy ==========
            hidePlaceholder('baselineChart');
            const totalClean = gridMix.clean_firm + gridMix.solar + gridMix.wind + gridMix.hydro;
            const hours = Array.from({length: 24}, (_, i) => i);
            const hourLabels = hours.map(h => {
                const ampm = h < 12 ? 'AM' : 'PM';
                const hr = h === 0 ? 12 : (h > 12 ? h - 12 : h);
                return hr + ampm;
            });
            // PJM: nuclear-dominated (flat), modest solar/wind, small hydro
            const hourlyClean = hours.map(h => {
                const solarFactor = Math.max(0, Math.sin(Math.PI * (h - 6) / 12));
                const solarContrib = gridMix.solar * solarFactor * 1.8;
                const windFactor = 0.75 + 0.25 * Math.sin(Math.PI * (h + 4) / 12);
                const windContrib = gridMix.wind * windFactor;
                const firmContrib = gridMix.clean_firm; // flat 24/7
                const hydroFactor = 0.85 + 0.15 * Math.sin(Math.PI * (h - 6) / 14);
                const hydroContrib = gridMix.hydro * hydroFactor;
                return Math.min(100, solarContrib + windContrib + firmContrib + hydroContrib);
            });

            new Chart(document.getElementById('baselineChart'), {
                type: 'line',
                data: {
                    labels: hourLabels,
                    datasets: [{
                        label: 'Clean Energy %', data: hourlyClean,
                        borderColor: '#1E3A5F', backgroundColor: 'rgba(30,58,95,0.15)',
                        fill: true, tension: 0.4, pointRadius: 3,
                        pointBackgroundColor: '#1E3A5F', borderWidth: 2.5
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        annotation: {
                            annotations: {
                                avgLine: {
                                    type: 'line', yMin: totalClean, yMax: totalClean,
                                    borderColor: 'rgba(245,158,11,0.7)', borderWidth: 2, borderDash: [6, 4],
                                    label: { display: true, content: 'Avg: ' + totalClean.toFixed(1) + '%', position: 'end', backgroundColor: 'rgba(245,158,11,0.85)', color: '#fff', font: { size: 11, weight: '600' } }
                                }
                            }
                        },
                        tooltip: { callbacks: { label: ctx => ctx.parsed.y.toFixed(1) + '% clean' } }
                    },
                    scales: {
                        y: { beginAtZero: true, max: 100, title: { display: true, text: 'Clean Energy %' }, grid: { color: 'rgba(0,0,0,0.06)' } },
                        x: { title: { display: true, text: 'Hour of Day' }, grid: { display: false } }
                    }
                }
            });

            // ========== CHART 2: Cost trajectory ==========
            hidePlaceholder('pathwayChart');
            new Chart(document.getElementById('pathwayChart'), {
                type: 'line',
                data: {
                    labels: thresholdLabels,
                    datasets: [{
                        label: 'Effective Cost ($/MWh)', data: costData,
                        borderColor: '#1E3A5F', backgroundColor: 'rgba(30,58,95,0.12)', fill: true,
                        tension: 0.3, pointRadius: 5, pointBackgroundColor: '#1E3A5F',
                        pointBorderColor: '#fff', pointBorderWidth: 2, borderWidth: 3
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        annotation: {
                            annotations: {
                                wholesale: {
                                    type: 'line', yMin: wholesalePrice, yMax: wholesalePrice,
                                    borderColor: 'rgba(107,114,128,0.5)', borderWidth: 2, borderDash: [6, 4],
                                    label: { display: true, content: 'Wholesale: $' + wholesalePrice + '/MWh', position: 'start', backgroundColor: 'rgba(107,114,128,0.8)', color: '#fff', font: { size: 11, weight: '600' } }
                                }
                            }
                        },
                        tooltip: { callbacks: { label: ctx => '$' + ctx.parsed.y.toFixed(2) + '/MWh' } }
                    },
                    scales: {
                        y: { beginAtZero: false, title: { display: true, text: 'Effective Cost ($/MWh)' }, grid: { color: 'rgba(0,0,0,0.06)' } },
                        x: { title: { display: true, text: 'Hourly Clean Energy Target' }, grid: { display: false } }
                    }
                }
            });

            // ========== CHART 3: Resource mix evolution ==========
            hidePlaceholder('mixEvolutionChart');
            new Chart(document.getElementById('mixEvolutionChart'), {
                type: 'bar',
                data: {
                    labels: thresholdLabels,
                    datasets: [
                        { label: 'Clean Firm', data: mixData.clean_firm, backgroundColor: COLORS.clean_firm },
                        { label: 'Solar', data: mixData.solar, backgroundColor: COLORS.solar },
                        { label: 'Wind', data: mixData.wind, backgroundColor: COLORS.wind },
                        { label: 'Hydro', data: mixData.hydro, backgroundColor: COLORS.hydro }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { usePointStyle: true, pointStyle: 'rectRounded', padding: 16, font: { size: 12 } } },
                        tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': ' + ctx.parsed.y + '%' } }
                    },
                    scales: {
                        y: { stacked: true, beginAtZero: true, max: 100, title: { display: true, text: 'Resource Mix (%)' }, grid: { color: 'rgba(0,0,0,0.06)' } },
                        x: { stacked: true, title: { display: true, text: 'Hourly Clean Energy Target' }, grid: { display: false } }
                    }
                }
            });

            // ========== CHART 4: Sensitivity (cost breakdown) ==========
            hidePlaceholder('sensitivityChart');
            const sensitivityThresholds = [75, 85, 95, 100];
            const sensLabels = sensitivityThresholds.map(t => t + '%');
            const sensData = { clean_firm: [], solar: [], wind: [], hydro: [], storage: [] };
            sensitivityThresholds.forEach(t => {
                const td = regionData.thresholds[String(t)];
                if (td) {
                    const rc = td.costs.resource_costs;
                    sensData.clean_firm.push(rc.clean_firm ? rc.clean_firm.cost_per_demand_mwh : 0);
                    sensData.solar.push(rc.solar ? (rc.solar.cost_per_demand_mwh || rc.solar.cost || 0) : 0);
                    sensData.wind.push(rc.wind ? (rc.wind.cost_per_demand_mwh || rc.wind.cost || 0) : 0);
                    sensData.hydro.push(rc.hydro ? (rc.hydro.cost_per_demand_mwh || 0) : 0);
                    sensData.storage.push(rc.storage ? rc.storage.cost_per_demand_mwh : 0);
                }
            });

            new Chart(document.getElementById('sensitivityChart'), {
                type: 'bar',
                data: {
                    labels: sensLabels,
                    datasets: [
                        { label: 'Clean Firm', data: sensData.clean_firm, backgroundColor: COLORS.clean_firm },
                        { label: 'Solar', data: sensData.solar, backgroundColor: COLORS.solar },
                        { label: 'Wind', data: sensData.wind, backgroundColor: COLORS.wind },
                        { label: 'Hydro', data: sensData.hydro, backgroundColor: COLORS.hydro },
                        { label: 'Storage', data: sensData.storage, backgroundColor: COLORS.battery }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { usePointStyle: true, pointStyle: 'rectRounded', padding: 16, font: { size: 12 } } },
                        tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': $' + ctx.parsed.y.toFixed(2) + '/MWh' } }
                    },
                    scales: {
                        y: { stacked: true, beginAtZero: true, title: { display: true, text: 'Cost per MWh of Demand ($/MWh)' }, grid: { color: 'rgba(0,0,0,0.06)' } },
                        x: { stacked: true, title: { display: true, text: 'Hourly Clean Energy Target' }, grid: { display: false } }
                    }
                }
            });

            // ========== CHART 5: Storage deployment ==========
            hidePlaceholder('storageChart');
            const batteryPcts = [];
            const ldesPcts = [];
            thresholds.forEach((t, i) => {
                const total = storageData[i] || 0;
                if (t >= 96) {
                    const ldesShare = Math.min(total, total * ((t - 92) / 12));
                    ldesPcts.push(parseFloat(ldesShare.toFixed(1)));
                    batteryPcts.push(parseFloat((total - ldesShare).toFixed(1)));
                } else {
                    batteryPcts.push(total);
                    ldesPcts.push(0);
                }
            });

            new Chart(document.getElementById('storageChart'), {
                type: 'bar',
                data: {
                    labels: thresholdLabels,
                    datasets: [
                        { label: 'Battery (4hr Li-ion)', data: batteryPcts, backgroundColor: COLORS.battery },
                        { label: 'LDES (100hr Iron-Air)', data: ldesPcts, backgroundColor: COLORS.ldes }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { usePointStyle: true, pointStyle: 'rectRounded', padding: 16, font: { size: 12 } } },
                        tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': ' + ctx.parsed.y + '% of demand' } }
                    },
                    scales: {
                        y: { stacked: true, beginAtZero: true, title: { display: true, text: 'Storage Dispatch (% of Demand)' }, grid: { color: 'rgba(0,0,0,0.06)' } },
                        x: { stacked: true, title: { display: true, text: 'Hourly Clean Energy Target' }, grid: { display: false } }
                    }
                }
            });

            // ========== CHART 6: CO2 Abatement ==========
            hidePlaceholder('abatementChart');
            const emissionRate = EMISSION_RATES[REGION];
            const avgAbatement = [];
            const margAbatement = [];
            thresholds.forEach((t, i) => {
                const td = regionData.thresholds[String(t)];
                if (!td) return;
                const cleanPct = t / 100;
                const incrementalCost = td.costs.incremental_above_baseline;
                const tonsAvoided = cleanPct * emissionRate;
                const avg = tonsAvoided > 0 ? incrementalCost / tonsAvoided : 0;
                avgAbatement.push(parseFloat(avg.toFixed(1)));
                if (i > 0) {
                    const prevTd = regionData.thresholds[String(thresholds[i - 1])];
                    if (prevTd) {
                        const deltaCost = td.costs.effective_cost_per_useful_mwh - prevTd.costs.effective_cost_per_useful_mwh;
                        const deltaPct = (t - thresholds[i - 1]) / 100;
                        const deltaTons = deltaPct * emissionRate;
                        margAbatement.push(parseFloat((deltaTons > 0 ? deltaCost / deltaTons : 0).toFixed(1)));
                    } else { margAbatement.push(0); }
                } else { margAbatement.push(avgAbatement[0]); }
            });

            new Chart(document.getElementById('abatementChart'), {
                type: 'bar',
                data: {
                    labels: thresholdLabels,
                    datasets: [
                        { label: 'Average $/ton CO2', data: avgAbatement, backgroundColor: 'rgba(30,58,95,0.75)', borderColor: '#1E3A5F', borderWidth: 1, order: 2 },
                        { label: 'Marginal $/ton CO2', data: margAbatement, type: 'line', borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)', pointBackgroundColor: '#EF4444', pointBorderColor: '#fff', pointBorderWidth: 2, pointRadius: 5, borderWidth: 2.5, tension: 0.3, fill: false, order: 1 }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { usePointStyle: true, padding: 16, font: { size: 12 } } },
                        tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': $' + ctx.parsed.y.toFixed(0) + '/ton' } }
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Abatement Cost ($/ton CO2)' }, grid: { color: 'rgba(0,0,0,0.06)' } },
                        x: { title: { display: true, text: 'Hourly Clean Energy Target' }, grid: { display: false } }
                    }
                }
            });

            // ========== CHART 7: Regional comparison ==========
            hidePlaceholder('comparisonChart');
            const allRegions = ['CAISO', 'ERCOT', 'PJM', 'NYISO', 'NEISO'];
            const compThresh = '90';
            const regionCosts = []; const regionLabels = []; const barColors = [];
            allRegions.forEach(r => {
                const rd = data.results[r];
                const td = rd ? rd.thresholds[compThresh] : null;
                if (td) {
                    regionLabels.push(r);
                    regionCosts.push(td.costs.effective_cost_per_useful_mwh);
                    barColors.push(r === REGION ? '#1E3A5F' : 'rgba(30,58,95,0.35)');
                }
            });
            const nationalAvgCost = regionCosts.reduce((a, b) => a + b, 0) / regionCosts.length;

            new Chart(document.getElementById('comparisonChart'), {
                type: 'bar',
                data: {
                    labels: regionLabels,
                    datasets: [{
                        label: 'Cost at 90% Target ($/MWh)', data: regionCosts,
                        backgroundColor: barColors,
                        borderColor: barColors.map(c => c === '#1E3A5F' ? '#0F1A2E' : 'rgba(30,58,95,0.5)'),
                        borderWidth: 1, borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y', responsive: true, maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        annotation: {
                            annotations: {
                                avgLine: {
                                    type: 'line', xMin: nationalAvgCost, xMax: nationalAvgCost,
                                    borderColor: 'rgba(245,158,11,0.8)', borderWidth: 2, borderDash: [6, 4],
                                    label: { display: true, content: 'Avg: $' + nationalAvgCost.toFixed(0), position: 'start', backgroundColor: 'rgba(245,158,11,0.85)', color: '#fff', font: { size: 11, weight: '600' } }
                                }
                            }
                        },
                        tooltip: { callbacks: { label: ctx => '$' + ctx.parsed.x.toFixed(2) + '/MWh at 90% target' } }
                    },
                    scales: {
                        x: { beginAtZero: true, title: { display: true, text: 'Effective Cost ($/MWh)' }, grid: { color: 'rgba(0,0,0,0.06)' } },
                        y: { grid: { display: false } }
                    }
                }
            });

        })
        .catch(err => {
            console.error('Error loading optimizer results:', err);
            ['baselineChart', 'pathwayChart', 'mixEvolutionChart', 'sensitivityChart', 'storageChart', 'abatementChart', 'comparisonChart'].forEach(id => {
                showError(id, 'Unable to load optimizer results. Please ensure overprocure_results.json is available.');
            });
        });
})();

// Scroll-triggered reveal animations
const revealObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.classList.add('revealed');
        }
    });
}, { threshold: 0.08, rootMargin: '0px 0px -60px 0px' });

// Apply scroll-reveal to major content sections
document.querySelectorAll('.scroll-section, .chart-container, .insights-list, .stat-callout, .section-title, .section-narrative, .stat-box').forEach((el, i) => {
    el.classList.add('scroll-reveal');
    if (i % 3 === 1) el.classList.add('reveal-delay-1');
    if (i % 3 === 2) el.classList.add('reveal-delay-2');
    revealObserver.observe(el);
});
</script>
</body>
</html>
